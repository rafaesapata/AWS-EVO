AWSTemplateFormatVersion: '2010-09-09'
Description: |
  EVO Platform - Complete Lambda Functions and API Gateway Endpoints
  Generated automatically by scripts/generate-cloudformation.ts
  Total handlers: 203
  API endpoints: 146
  Internal/Scheduled handlers: 57

# =============================================================================
# PARAMETERS
# =============================================================================

Parameters:
  ProjectName:
    Type: String
    Default: evo-uds-v3
    Description: Project name prefix for all resources

  Environment:
    Type: String
    Default: production
    AllowedValues: [production, staging, development]
    Description: Deployment environment

  RestApiId:
    Type: String
    Description: API Gateway REST API ID

  FunctionsResourceId:
    Type: String
    Description: API Gateway resource ID for /api/functions

  AuthorizerId:
    Type: String
    Description: API Gateway Cognito Authorizer ID

  LambdaCodeBucket:
    Type: String
    Description: S3 bucket containing Lambda code packages

  LambdaExecutionRoleArn:
    Type: String
    Description: ARN of the Lambda execution IAM role

  LambdaSecurityGroupId:
    Type: String
    Description: Security Group ID for Lambda functions

  PrivateSubnet1Id:
    Type: String
    Description: Private Subnet 1 ID for Lambda VPC config

  PrivateSubnet2Id:
    Type: String
    Description: Private Subnet 2 ID for Lambda VPC config

  LambdaLayerArn:
    Type: String
    Description: ARN of the Lambda layer with dependencies

  DatabaseSecretArn:
    Type: String
    Description: ARN of the Secrets Manager secret for database credentials

  DatabaseEndpoint:
    Type: String
    Description: RDS Proxy endpoint for database connections

  CognitoUserPoolId:
    Type: String
    Description: Cognito User Pool ID for authentication

# =============================================================================
# RESOURCES
# =============================================================================

Resources:
  AdminManageUserFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-admin-manage-user'
      Runtime: nodejs18.x
      Handler: admin-manage-user.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/admin-manage-user.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AutomatedCleanupStuckScansFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-automated-cleanup-stuck-scans'
      Runtime: nodejs18.x
      Handler: automated-cleanup-stuck-scans.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/automated-cleanup-stuck-scans.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckCloudtrailStatusFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-cloudtrail-status'
      Runtime: nodejs18.x
      Handler: check-cloudtrail-status.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/check-cloudtrail-status.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckCostsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-costs'
      Runtime: nodejs18.x
      Handler: check-costs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/check-costs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupStuckScansFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans'
      Runtime: nodejs18.x
      Handler: cleanup-stuck-scans.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/cleanup-stuck-scans.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateCognitoUserFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-cognito-user'
      Runtime: nodejs18.x
      Handler: create-cognito-user.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/create-cognito-user.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateUserFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-user'
      Runtime: nodejs18.x
      Handler: create-user.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/create-user.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DeactivateDemoModeFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-deactivate-demo-mode'
      Runtime: nodejs18.x
      Handler: deactivate-demo-mode.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/deactivate-demo-mode.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DebugCloudtrailFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-debug-cloudtrail'
      Runtime: nodejs18.x
      Handler: debug-cloudtrail.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/debug-cloudtrail.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DirectCleanupFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-direct-cleanup'
      Runtime: nodejs18.x
      Handler: direct-cleanup.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/direct-cleanup.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DisableCognitoUserFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-disable-cognito-user'
      Runtime: nodejs18.x
      Handler: disable-cognito-user.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/disable-cognito-user.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FixRoleArnMigrationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fix-role-arn-migration'
      Runtime: nodejs18.x
      Handler: fix-role-arn-migration.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/fix-role-arn-migration.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  LogAuditFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-log-audit'
      Runtime: nodejs18.x
      Handler: log-audit.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/log-audit.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageDemoModeFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-demo-mode'
      Runtime: nodejs18.x
      Handler: manage-demo-mode.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/manage-demo-mode.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageEmailTemplatesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-email-templates'
      Runtime: nodejs18.x
      Handler: manage-email-templates.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/manage-email-templates.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageOrganizationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-organizations'
      Runtime: nodejs18.x
      Handler: manage-organizations.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/manage-organizations.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RunMigrationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-run-migration'
      Runtime: nodejs18.x
      Handler: run-migration.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/run-migration.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RunMigrationStandaloneFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-run-migration-standalone'
      Runtime: nodejs18.x
      Handler: run-migration-standalone.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/run-migration-standalone.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RunSqlFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-run-sql'
      Runtime: nodejs18.x
      Handler: run-sql.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/run-sql.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SetupLicenseConfigFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-setup-license-config'
      Runtime: nodejs18.x
      Handler: setup-license-config.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/admin/setup-license-config.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  BedrockChatFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-bedrock-chat'
      Runtime: nodejs18.x
      Handler: bedrock-chat.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/bedrock-chat.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckProactiveNotificationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-proactive-notifications'
      Runtime: nodejs18.x
      Handler: check-proactive-notifications.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/check-proactive-notifications.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateResponseFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-response'
      Runtime: nodejs18.x
      Handler: generate-response.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/generate-response.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetAiNotificationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-ai-notifications'
      Runtime: nodejs18.x
      Handler: get-ai-notifications.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/get-ai-notifications.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListAiNotificationsAdminFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-ai-notifications-admin'
      Runtime: nodejs18.x
      Handler: list-ai-notifications-admin.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/list-ai-notifications-admin.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageNotificationRulesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-notification-rules'
      Runtime: nodejs18.x
      Handler: manage-notification-rules.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/manage-notification-rules.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SendAiNotificationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-send-ai-notification'
      Runtime: nodejs18.x
      Handler: send-ai-notification.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/send-ai-notification.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  UpdateAiNotificationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-update-ai-notification'
      Runtime: nodejs18.x
      Handler: update-ai-notification.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ai/update-ai-notification.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DeleteWebauthnCredentialFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-delete-webauthn-credential'
      Runtime: nodejs18.x
      Handler: delete-webauthn-credential.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/delete-webauthn-credential.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DeleteWebauthnCredentialAdminFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-delete-webauthn-credential-admin'
      Runtime: nodejs18.x
      Handler: delete-webauthn-credential-admin.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/delete-webauthn-credential-admin.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ForgotPasswordFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-forgot-password'
      Runtime: nodejs18.x
      Handler: forgot-password.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/forgot-password.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaEnrollFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-enroll'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaCheckFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-check'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaChallengeVerifyFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-challenge-verify'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaVerifyLoginFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-verify-login'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaListFactorsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-list-factors'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MfaUnenrollFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mfa-unenroll'
      Runtime: nodejs18.x
      Handler: mfa-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/mfa-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SelfRegisterFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-self-register'
      Runtime: nodejs18.x
      Handler: self-register.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/self-register.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  VerifyTvTokenFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-verify-tv-token'
      Runtime: nodejs18.x
      Handler: verify-tv-token.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/verify-tv-token.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WebauthnAuthenticateFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-webauthn-authenticate'
      Runtime: nodejs18.x
      Handler: webauthn-authenticate.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/webauthn-authenticate.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WebauthnCheckFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-webauthn-check'
      Runtime: nodejs18.x
      Handler: webauthn-check-standalone.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/webauthn-check-standalone.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WebauthnRegisterFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-webauthn-register'
      Runtime: nodejs18.x
      Handler: webauthn-register.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/auth/webauthn-register.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListAwsCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-aws-credentials'
      Runtime: nodejs18.x
      Handler: list-aws-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/aws/list-aws-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SaveAwsCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-save-aws-credentials'
      Runtime: nodejs18.x
      Handler: save-aws-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/aws/save-aws-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  UpdateAwsCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-update-aws-credentials'
      Runtime: nodejs18.x
      Handler: update-aws-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/aws/update-aws-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureActivityLogsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-activity-logs'
      Runtime: nodejs18.x
      Handler: azure-activity-logs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-activity-logs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureComplianceScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-compliance-scan'
      Runtime: nodejs18.x
      Handler: azure-compliance-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-compliance-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 1024
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureCostOptimizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-cost-optimization'
      Runtime: nodejs18.x
      Handler: azure-cost-optimization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-cost-optimization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureDefenderScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-defender-scan'
      Runtime: nodejs18.x
      Handler: azure-defender-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-defender-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureDetectAnomaliesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-detect-anomalies'
      Runtime: nodejs18.x
      Handler: azure-detect-anomalies.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-detect-anomalies.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureFetchCostsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-fetch-costs'
      Runtime: nodejs18.x
      Handler: azure-fetch-costs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-fetch-costs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureFetchEdgeServicesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-fetch-edge-services'
      Runtime: nodejs18.x
      Handler: azure-fetch-edge-services.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-fetch-edge-services.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureFetchMonitorMetricsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-fetch-monitor-metrics'
      Runtime: nodejs18.x
      Handler: azure-fetch-monitor-metrics.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-fetch-monitor-metrics.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureOauthCallbackFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-oauth-callback'
      Runtime: nodejs18.x
      Handler: azure-oauth-callback.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-oauth-callback.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureOauthInitiateFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-oauth-initiate'
      Runtime: nodejs18.x
      Handler: azure-oauth-initiate.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-oauth-initiate.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureOauthRefreshFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-oauth-refresh'
      Runtime: nodejs18.x
      Handler: azure-oauth-refresh.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-oauth-refresh.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureOauthRevokeFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-oauth-revoke'
      Runtime: nodejs18.x
      Handler: azure-oauth-revoke.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-oauth-revoke.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureReservationsAnalyzerFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-reservations-analyzer'
      Runtime: nodejs18.x
      Handler: azure-reservations-analyzer.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-reservations-analyzer.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureResourceInventoryFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-resource-inventory'
      Runtime: nodejs18.x
      Handler: azure-resource-inventory.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-resource-inventory.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureSecurityScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-security-scan'
      Runtime: nodejs18.x
      Handler: azure-security-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-security-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 1024
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AzureWellArchitectedScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-azure-well-architected-scan'
      Runtime: nodejs18.x
      Handler: azure-well-architected-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/azure-well-architected-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DebugAzureCostsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-debug-azure-costs'
      Runtime: nodejs18.x
      Handler: debug-azure-costs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/debug-azure-costs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DeleteAzureCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-delete-azure-credentials'
      Runtime: nodejs18.x
      Handler: delete-azure-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/delete-azure-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListAzureCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-azure-credentials'
      Runtime: nodejs18.x
      Handler: list-azure-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/list-azure-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SaveAzureCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-save-azure-credentials'
      Runtime: nodejs18.x
      Handler: save-azure-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/save-azure-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StartAzureSecurityScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-start-azure-security-scan'
      Runtime: nodejs18.x
      Handler: start-azure-security-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/start-azure-security-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidateAzureCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-azure-credentials'
      Runtime: nodejs18.x
      Handler: validate-azure-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/validate-azure-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidateAzurePermissionsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-azure-permissions'
      Runtime: nodejs18.x
      Handler: validate-azure-permissions.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/azure/validate-azure-permissions.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListCloudCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-cloud-credentials'
      Runtime: nodejs18.x
      Handler: list-cloud-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cloud/list-cloud-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AnalyzeRiSpFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-analyze-ri-sp'
      Runtime: nodejs18.x
      Handler: analyze-ri-sp.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/analyze-ri-sp.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  BudgetForecastFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-budget-forecast'
      Runtime: nodejs18.x
      Handler: budget-forecast.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/budget-forecast.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CostOptimizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cost-optimization'
      Runtime: nodejs18.x
      Handler: cost-optimization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/cost-optimization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FetchDailyCostsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fetch-daily-costs'
      Runtime: nodejs18.x
      Handler: fetch-daily-costs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/fetch-daily-costs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FinopsCopilotFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-finops-copilot'
      Runtime: nodejs18.x
      Handler: finops-copilot-v2.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/finops-copilot-v2.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateCostForecastFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-cost-forecast'
      Runtime: nodejs18.x
      Handler: generate-cost-forecast.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/generate-cost-forecast.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetRiSpAnalysisFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-ri-sp-analysis'
      Runtime: nodejs18.x
      Handler: get-ri-sp-analysis.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/get-ri-sp-analysis.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetRiSpDataFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-ri-sp-data'
      Runtime: nodejs18.x
      Handler: get-ri-sp-data.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/get-ri-sp-data.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListRiSpHistoryFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-ri-sp-history'
      Runtime: nodejs18.x
      Handler: list-ri-sp-history.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/list-ri-sp-history.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MlWasteDetectionFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-ml-waste-detection'
      Runtime: nodejs18.x
      Handler: ml-waste-detection.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/ml-waste-detection.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RiSpAnalyzerFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-ri-sp-analyzer'
      Runtime: nodejs18.x
      Handler: ri-sp-analyzer.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/ri-sp-analyzer.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SaveRiSpAnalysisFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-save-ri-sp-analysis'
      Runtime: nodejs18.x
      Handler: save-ri-sp-analysis.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/save-ri-sp-analysis.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetExecutiveDashboardFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-executive-dashboard'
      Runtime: nodejs18.x
      Handler: get-executive-dashboard.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/dashboard/get-executive-dashboard.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetExecutiveDashboardPublicFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-executive-dashboard-public'
      Runtime: nodejs18.x
      Handler: get-executive-dashboard-public.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/dashboard/get-executive-dashboard-public.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageTvTokensFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-tv-tokens'
      Runtime: nodejs18.x
      Handler: manage-tv-tokens.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/dashboard/manage-tv-tokens.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageCloudBudgetFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-cloud-budget'
      Runtime: nodejs18.x
      Handler: manage-cloud-budget.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/cost/manage-cloud-budget.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupCostDataFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-cost-data'
      Runtime: nodejs18.x
      Handler: cleanup-cost-data.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/data/cleanup-cost-data.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MutateTableFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-mutate-table'
      Runtime: nodejs18.x
      Handler: mutate-table.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/data/mutate-table.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  QueryTableFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-query-table'
      Runtime: nodejs18.x
      Handler: query-table.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/data/query-table.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  TicketAttachmentsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-ticket-attachments'
      Runtime: nodejs18.x
      Handler: ticket-attachments.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/data/ticket-attachments.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  TicketManagementFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-ticket-management'
      Runtime: nodejs18.x
      Handler: ticket-management.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/data/ticket-management.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckDailyCostsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-daily-costs'
      Runtime: nodejs18.x
      Handler: check-daily-costs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/debug/check-daily-costs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DiagnoseCostDashboardFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-diagnose-cost-dashboard'
      Runtime: nodejs18.x
      Handler: diagnose-cost-dashboard.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/debug/diagnose-cost-dashboard.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  InvestigateDataMismatchFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-investigate-data-mismatch'
      Runtime: nodejs18.x
      Handler: investigate-data-mismatch.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/debug/investigate-data-mismatch.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CloudformationWebhookFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cloudformation-webhook'
      Runtime: nodejs18.x
      Handler: cloudformation-webhook.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/integrations/cloudformation-webhook.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateJiraTicketFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-jira-ticket'
      Runtime: nodejs18.x
      Handler: create-jira-ticket.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/integrations/create-jira-ticket.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AutoCleanupStuckScansFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-auto-cleanup-stuck-scans'
      Runtime: nodejs18.x
      Handler: auto-cleanup-stuck-scans.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/auto-cleanup-stuck-scans.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupExpiredExternalIdsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-expired-external-ids'
      Runtime: nodejs18.x
      Handler: cleanup-expired-external-ids.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/cleanup-expired-external-ids.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupExpiredOauthStatesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-expired-oauth-states'
      Runtime: nodejs18.x
      Handler: cleanup-expired-oauth-states.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/cleanup-expired-oauth-states.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupStuckScansFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans'
      Runtime: nodejs18.x
      Handler: cleanup-stuck-scans.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/cleanup-stuck-scans.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ExecuteScheduledJobFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-execute-scheduled-job'
      Runtime: nodejs18.x
      Handler: execute-scheduled-job.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/execute-scheduled-job.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  InitialDataLoadFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-initial-data-load'
      Runtime: nodejs18.x
      Handler: initial-data-load.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/initial-data-load.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListBackgroundJobsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-background-jobs'
      Runtime: nodejs18.x
      Handler: list-background-jobs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/list-background-jobs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ProcessBackgroundJobsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-process-background-jobs'
      Runtime: nodejs18.x
      Handler: process-background-jobs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/process-background-jobs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ProcessEventsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-process-events'
      Runtime: nodejs18.x
      Handler: process-events.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/process-events.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ScheduledScanExecutorFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-scheduled-scan-executor'
      Runtime: nodejs18.x
      Handler: scheduled-scan-executor.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/scheduled-scan-executor.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ScheduledViewRefreshFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-scheduled-view-refresh'
      Runtime: nodejs18.x
      Handler: scheduled-view-refresh.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/scheduled-view-refresh.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckSlaEscalationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-sla-escalations'
      Runtime: nodejs18.x
      Handler: check-sla-escalations.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/check-sla-escalations.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SendScheduledEmailsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-send-scheduled-emails'
      Runtime: nodejs18.x
      Handler: send-scheduled-emails.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/send-scheduled-emails.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SyncResourceInventoryFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-sync-resource-inventory'
      Runtime: nodejs18.x
      Handler: sync-resource-inventory.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/jobs/sync-resource-inventory.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  IncrementArticleHelpfulFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-increment-article-helpful'
      Runtime: nodejs18.x
      Handler: increment-article-helpful.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/increment-article-helpful.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  IncrementArticleViewsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-increment-article-views'
      Runtime: nodejs18.x
      Handler: increment-article-views.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/increment-article-views.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  KbAiSuggestionsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-kb-ai-suggestions'
      Runtime: nodejs18.x
      Handler: kb-ai-suggestions.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/kb-ai-suggestions.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  KbAnalyticsDashboardFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-kb-analytics-dashboard'
      Runtime: nodejs18.x
      Handler: kb-analytics-dashboard.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/kb-analytics-dashboard.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  KbArticleTrackingFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-kb-article-tracking'
      Runtime: nodejs18.x
      Handler: kb-article-tracking.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/kb-article-tracking.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  KbExportPdfFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-kb-export-pdf'
      Runtime: nodejs18.x
      Handler: kb-export-pdf.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/kb-export-pdf.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  TrackArticleViewDetailedFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-track-article-view-detailed'
      Runtime: nodejs18.x
      Handler: track-article-view-detailed.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/kb/track-article-view-detailed.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AdminSyncLicenseFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-admin-sync-license'
      Runtime: nodejs18.x
      Handler: admin-sync-license.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/admin-sync-license.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupSeatsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-seats'
      Runtime: nodejs18.x
      Handler: cleanup-seats.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/cleanup-seats.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ConfigureLicenseFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-configure-license'
      Runtime: nodejs18.x
      Handler: configure-license.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/configure-license.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DailyLicenseValidationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-daily-license-validation'
      Runtime: nodejs18.x
      Handler: daily-license-validation.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/daily-license-validation.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageSeatAssignmentsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-seat-assignments'
      Runtime: nodejs18.x
      Handler: manage-seat-assignments.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/manage-seat-assignments.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageSeatsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-seats'
      Runtime: nodejs18.x
      Handler: manage-seats.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/manage-seats.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ScheduledLicenseSyncFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-scheduled-license-sync'
      Runtime: nodejs18.x
      Handler: scheduled-license-sync.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/scheduled-license-sync.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SyncLicenseFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-sync-license'
      Runtime: nodejs18.x
      Handler: sync-license.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/sync-license.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidateLicenseFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-license'
      Runtime: nodejs18.x
      Handler: validate-license.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/license/validate-license.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MaintenanceAutoCleanupStuckScansFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-maintenance-auto-cleanup-stuck-scans'
      Runtime: nodejs18.x
      Handler: auto-cleanup-stuck-scans.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/maintenance/auto-cleanup-stuck-scans.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CleanupStuckScansSimpleFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans-simple'
      Runtime: nodejs18.x
      Handler: cleanup-stuck-scans-simple.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/maintenance/cleanup-stuck-scans-simple.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AiPrioritizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-ai-prioritization'
      Runtime: nodejs18.x
      Handler: ai-prioritization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ml/ai-prioritization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DetectAnomaliesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-detect-anomalies'
      Runtime: nodejs18.x
      Handler: detect-anomalies.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ml/detect-anomalies.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateAiInsightsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-ai-insights'
      Runtime: nodejs18.x
      Handler: generate-ai-insights.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ml/generate-ai-insights.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  IntelligentAlertsAnalyzerFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-intelligent-alerts-analyzer'
      Runtime: nodejs18.x
      Handler: intelligent-alerts-analyzer.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ml/intelligent-alerts-analyzer.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  PredictIncidentsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-predict-incidents'
      Runtime: nodejs18.x
      Handler: predict-incidents.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/ml/predict-incidents.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AlertsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-alerts'
      Runtime: nodejs18.x
      Handler: alerts.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/alerts.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AutoAlertsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-auto-alerts'
      Runtime: nodejs18.x
      Handler: auto-alerts.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/auto-alerts.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AwsRealtimeMetricsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-aws-realtime-metrics'
      Runtime: nodejs18.x
      Handler: aws-realtime-metrics.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/aws-realtime-metrics.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckAlertRulesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-alert-rules'
      Runtime: nodejs18.x
      Handler: check-alert-rules.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/check-alert-rules.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  EndpointMonitorCheckFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-endpoint-monitor-check'
      Runtime: nodejs18.x
      Handler: endpoint-monitor-check.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/endpoint-monitor-check.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ErrorAggregatorFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-error-aggregator'
      Runtime: nodejs18.x
      Handler: error-aggregator.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/error-aggregator.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FetchCloudwatchMetricsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fetch-cloudwatch-metrics'
      Runtime: nodejs18.x
      Handler: fetch-cloudwatch-metrics.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/fetch-cloudwatch-metrics.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FetchEdgeServicesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fetch-edge-services'
      Runtime: nodejs18.x
      Handler: fetch-edge-services.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/fetch-edge-services.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateErrorFixPromptFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-error-fix-prompt'
      Runtime: nodejs18.x
      Handler: generate-error-fix-prompt.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/generate-error-fix-prompt.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetLambdaHealthFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-lambda-health'
      Runtime: nodejs18.x
      Handler: get-lambda-health.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/get-lambda-health.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetPlatformMetricsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-platform-metrics'
      Runtime: nodejs18.x
      Handler: get-platform-metrics.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/get-platform-metrics.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetRecentErrorsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-recent-errors'
      Runtime: nodejs18.x
      Handler: get-recent-errors.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/get-recent-errors.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  HealthCheckFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-health-check'
      Runtime: nodejs18.x
      Handler: health-check.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/health-check.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  LambdaHealthCheckFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-lambda-health-check'
      Runtime: nodejs18.x
      Handler: lambda-health-check.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/lambda-health-check.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  LogFrontendErrorFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-log-frontend-error'
      Runtime: nodejs18.x
      Handler: log-frontend-error.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/log-frontend-error.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  MonitoredEndpointsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-monitored-endpoints'
      Runtime: nodejs18.x
      Handler: monitored-endpoints.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/monitored-endpoints.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  TestLambdaMetricsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-test-lambda-metrics'
      Runtime: nodejs18.x
      Handler: test-lambda-metrics.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/monitoring/test-lambda-metrics.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetCommunicationLogsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-communication-logs'
      Runtime: nodejs18.x
      Handler: get-communication-logs.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/notifications/get-communication-logs.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ManageEmailPreferencesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-manage-email-preferences'
      Runtime: nodejs18.x
      Handler: manage-email-preferences.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/notifications/manage-email-preferences.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SendEmailFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-send-email'
      Runtime: nodejs18.x
      Handler: send-email.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/notifications/send-email.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SendNotificationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-send-notification'
      Runtime: nodejs18.x
      Handler: send-notification.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/notifications/send-notification.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateOrganizationAccountFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-organization-account'
      Runtime: nodejs18.x
      Handler: create-organization-account.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/organizations/create-organization-account.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SyncOrganizationAccountsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-sync-organization-accounts'
      Runtime: nodejs18.x
      Handler: sync-organization-accounts.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/organizations/sync-organization-accounts.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckOrganizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-organization'
      Runtime: nodejs18.x
      Handler: check-organization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/profiles/check-organization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateWithOrganizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-with-organization'
      Runtime: nodejs18.x
      Handler: create-with-organization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/profiles/create-with-organization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetUserOrganizationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-user-organization'
      Runtime: nodejs18.x
      Handler: get-user-organization.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/profiles/get-user-organization.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateExcelReportFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-excel-report'
      Runtime: nodejs18.x
      Handler: generate-excel-report.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/reports/generate-excel-report.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GeneratePdfReportFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-pdf-report'
      Runtime: nodejs18.x
      Handler: generate-pdf-report.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/reports/generate-pdf-report.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateRemediationScriptFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-remediation-script'
      Runtime: nodejs18.x
      Handler: generate-remediation-script.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/reports/generate-remediation-script.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GenerateSecurityPdfFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-generate-security-pdf'
      Runtime: nodejs18.x
      Handler: generate-security-pdf.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/reports/generate-security-pdf.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SecurityScanPdfExportFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-security-scan-pdf-export'
      Runtime: nodejs18.x
      Handler: security-scan-pdf-export.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/reports/security-scan-pdf-export.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AnalyzeCloudtrailFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-analyze-cloudtrail'
      Runtime: nodejs18.x
      Handler: analyze-cloudtrail.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/analyze-cloudtrail.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ComplianceScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-compliance-scan'
      Runtime: nodejs18.x
      Handler: compliance-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/compliance-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 1024
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CreateRemediationTicketFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-create-remediation-ticket'
      Runtime: nodejs18.x
      Handler: create-remediation-ticket.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/create-remediation-ticket.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DriftDetectionFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-drift-detection'
      Runtime: nodejs18.x
      Handler: drift-detection.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/drift-detection.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FetchCloudtrailFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fetch-cloudtrail'
      Runtime: nodejs18.x
      Handler: fetch-cloudtrail.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/fetch-cloudtrail.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetComplianceHistoryFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-compliance-history'
      Runtime: nodejs18.x
      Handler: get-compliance-history.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/get-compliance-history.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetComplianceScanStatusFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-compliance-scan-status'
      Runtime: nodejs18.x
      Handler: get-compliance-scan-status.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/get-compliance-scan-status.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetFindingsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-findings'
      Runtime: nodejs18.x
      Handler: get-findings.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/get-findings.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GetSecurityPostureFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-get-security-posture'
      Runtime: nodejs18.x
      Handler: get-security-posture.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/get-security-posture.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  GuarddutyScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-guardduty-scan'
      Runtime: nodejs18.x
      Handler: guardduty-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/guardduty-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  IamBehaviorAnalysisFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-iam-behavior-analysis'
      Runtime: nodejs18.x
      Handler: iam-behavior-analysis.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/iam-behavior-analysis.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  IamDeepAnalysisFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-iam-deep-analysis'
      Runtime: nodejs18.x
      Handler: iam-deep-analysis.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/iam-deep-analysis.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  LateralMovementDetectionFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-lateral-movement-detection'
      Runtime: nodejs18.x
      Handler: lateral-movement-detection.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/lateral-movement-detection.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 120
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  SecurityScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-security-scan'
      Runtime: nodejs18.x
      Handler: security-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/security-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 1024
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StartAnalyzeCloudtrailFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-start-analyze-cloudtrail'
      Runtime: nodejs18.x
      Handler: start-analyze-cloudtrail.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/start-analyze-cloudtrail.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StartCloudtrailAnalysisFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-start-cloudtrail-analysis'
      Runtime: nodejs18.x
      Handler: start-cloudtrail-analysis.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/start-cloudtrail-analysis.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StartComplianceScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-start-compliance-scan'
      Runtime: nodejs18.x
      Handler: start-compliance-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/start-compliance-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StartSecurityScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-start-security-scan'
      Runtime: nodejs18.x
      Handler: start-security-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/start-security-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidateAwsCredentialsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-aws-credentials'
      Runtime: nodejs18.x
      Handler: validate-aws-credentials.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/validate-aws-credentials.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidatePermissionsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-permissions'
      Runtime: nodejs18.x
      Handler: validate-permissions.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/validate-permissions.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ValidateWafSecurityFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-validate-waf-security'
      Runtime: nodejs18.x
      Handler: validate-waf-security.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/validate-waf-security.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafDashboardApiFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-dashboard-api'
      Runtime: nodejs18.x
      Handler: waf-dashboard-api.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-dashboard-api.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafLogForwarderFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-log-forwarder'
      Runtime: nodejs18.x
      Handler: waf-log-forwarder.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-log-forwarder.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafLogProcessorFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-log-processor'
      Runtime: nodejs18.x
      Handler: waf-log-processor.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-log-processor.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafSetupMonitoringFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-setup-monitoring'
      Runtime: nodejs18.x
      Handler: waf-setup-monitoring.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-setup-monitoring.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafThreatAnalyzerFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-threat-analyzer'
      Runtime: nodejs18.x
      Handler: waf-threat-analyzer.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-threat-analyzer.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WafUnblockExpiredFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-waf-unblock-expired'
      Runtime: nodejs18.x
      Handler: waf-unblock-expired.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/waf-unblock-expired.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WellArchitectedScanFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-well-architected-scan'
      Runtime: nodejs18.x
      Handler: well-architected-scan.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/security/well-architected-scan.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StorageDownloadFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-storage-download'
      Runtime: nodejs18.x
      Handler: storage-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/storage/storage-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  StorageDeleteFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-storage-delete'
      Runtime: nodejs18.x
      Handler: storage-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/storage/storage-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  UploadAttachmentFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-upload-attachment'
      Runtime: nodejs18.x
      Handler: storage-handlers.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/storage/storage-handlers.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 60
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  AddStatusColumnFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-add-status-column'
      Runtime: nodejs18.x
      Handler: add-status-column.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/add-status-column.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  CheckMigrationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-check-migrations'
      Runtime: nodejs18.x
      Handler: check-migrations.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/check-migrations.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DbInitFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-db-init'
      Runtime: nodejs18.x
      Handler: db-init.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/db-init.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 512
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  DebugOrgQueryFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-debug-org-query'
      Runtime: nodejs18.x
      Handler: debug-org-query.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/debug-org-query.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  FixAzureConstraintsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-fix-azure-constraints'
      Runtime: nodejs18.x
      Handler: fix-azure-constraints.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/fix-azure-constraints.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  ListTablesFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-list-tables'
      Runtime: nodejs18.x
      Handler: list-tables.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/list-tables.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RunMigrationsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-run-migrations'
      Runtime: nodejs18.x
      Handler: run-migrations.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/run-migrations.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  RunSqlMigrationFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-run-sql-migration'
      Runtime: nodejs18.x
      Handler: run-sql-migration.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/system/run-sql-migration.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 300
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  NotificationSettingsFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-notification-settings'
      Runtime: nodejs18.x
      Handler: notification-settings.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/user/notification-settings.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WebsocketConnectFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-websocket-connect'
      Runtime: nodejs18.x
      Handler: connect.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/websocket/connect.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  WebsocketDisconnectFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-${Environment}-websocket-disconnect'
      Runtime: nodejs18.x
      Handler: disconnect.handler
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: handlers/websocket/disconnect.zip
      Role: !Ref LambdaExecutionRoleArn
      Timeout: 30
      MemorySize: 256
      VpcConfig:
        SecurityGroupIds: [!Ref LambdaSecurityGroupId]
        SubnetIds: [!Ref PrivateSubnet1Id, !Ref PrivateSubnet2Id]
      Layers: [!Ref LambdaLayerArn]
      Environment:
        Variables:
          DATABASE_URL: !Sub 
            - 'postgresql://${Username}:${Password}@${Host}:5432/evouds?schema=public&sslmode=require'
            - Username: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:username}}'
              Password: !Sub '{{resolve:secretsmanager:${DatabaseSecretArn}:SecretString:password}}'
              Host: !Ref DatabaseEndpoint
          NODE_PATH: /opt/nodejs/node_modules
          COGNITO_USER_POOL_ID: !Ref CognitoUserPoolId
  # ---------------------------------------------------------------------------
  # ADMIN-MANAGE-USER ENDPOINT
  # ---------------------------------------------------------------------------
  
  AdminManageUserResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: admin-manage-user

  AdminManageUserOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AdminManageUserResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AdminManageUserPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AdminManageUserResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AdminManageUserFunction.Arn}/invocations'

  AdminManageUserLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AdminManageUserFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/admin-manage-user'
  # ---------------------------------------------------------------------------
  # CREATE-COGNITO-USER ENDPOINT
  # ---------------------------------------------------------------------------
  
  CreateCognitoUserResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: create-cognito-user

  CreateCognitoUserOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateCognitoUserResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CreateCognitoUserPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateCognitoUserResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateCognitoUserFunction.Arn}/invocations'

  CreateCognitoUserLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CreateCognitoUserFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/create-cognito-user'
  # ---------------------------------------------------------------------------
  # CREATE-USER ENDPOINT
  # ---------------------------------------------------------------------------
  
  CreateUserResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: create-user

  CreateUserOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateUserResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CreateUserPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateUserResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateUserFunction.Arn}/invocations'

  CreateUserLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CreateUserFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/create-user'
  # ---------------------------------------------------------------------------
  # DEACTIVATE-DEMO-MODE ENDPOINT
  # ---------------------------------------------------------------------------
  
  DeactivateDemoModeResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: deactivate-demo-mode

  DeactivateDemoModeOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeactivateDemoModeResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DeactivateDemoModePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeactivateDemoModeResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DeactivateDemoModeFunction.Arn}/invocations'

  DeactivateDemoModeLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DeactivateDemoModeFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/deactivate-demo-mode'
  # ---------------------------------------------------------------------------
  # DISABLE-COGNITO-USER ENDPOINT
  # ---------------------------------------------------------------------------
  
  DisableCognitoUserResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: disable-cognito-user

  DisableCognitoUserOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DisableCognitoUserResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DisableCognitoUserPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DisableCognitoUserResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DisableCognitoUserFunction.Arn}/invocations'

  DisableCognitoUserLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DisableCognitoUserFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/disable-cognito-user'
  # ---------------------------------------------------------------------------
  # LOG-AUDIT ENDPOINT
  # ---------------------------------------------------------------------------
  
  LogAuditResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: log-audit

  LogAuditOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LogAuditResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  LogAuditPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LogAuditResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LogAuditFunction.Arn}/invocations'

  LogAuditLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref LogAuditFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/log-audit'
  # ---------------------------------------------------------------------------
  # MANAGE-DEMO-MODE ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageDemoModeResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-demo-mode

  ManageDemoModeOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageDemoModeResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageDemoModePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageDemoModeResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageDemoModeFunction.Arn}/invocations'

  ManageDemoModeLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageDemoModeFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-demo-mode'
  # ---------------------------------------------------------------------------
  # MANAGE-EMAIL-TEMPLATES ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageEmailTemplatesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-email-templates

  ManageEmailTemplatesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageEmailTemplatesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageEmailTemplatesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageEmailTemplatesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageEmailTemplatesFunction.Arn}/invocations'

  ManageEmailTemplatesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageEmailTemplatesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-email-templates'
  # ---------------------------------------------------------------------------
  # MANAGE-ORGANIZATIONS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageOrganizationsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-organizations

  ManageOrganizationsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageOrganizationsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageOrganizationsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageOrganizationsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageOrganizationsFunction.Arn}/invocations'

  ManageOrganizationsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageOrganizationsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-organizations'
  # ---------------------------------------------------------------------------
  # BEDROCK-CHAT ENDPOINT
  # ---------------------------------------------------------------------------
  
  BedrockChatResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: bedrock-chat

  BedrockChatOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref BedrockChatResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  BedrockChatPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref BedrockChatResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BedrockChatFunction.Arn}/invocations'

  BedrockChatLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref BedrockChatFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/bedrock-chat'
  # ---------------------------------------------------------------------------
  # GET-AI-NOTIFICATIONS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetAiNotificationsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-ai-notifications

  GetAiNotificationsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetAiNotificationsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetAiNotificationsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetAiNotificationsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetAiNotificationsFunction.Arn}/invocations'

  GetAiNotificationsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetAiNotificationsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-ai-notifications'
  # ---------------------------------------------------------------------------
  # LIST-AI-NOTIFICATIONS-ADMIN ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListAiNotificationsAdminResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-ai-notifications-admin

  ListAiNotificationsAdminOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAiNotificationsAdminResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListAiNotificationsAdminPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAiNotificationsAdminResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListAiNotificationsAdminFunction.Arn}/invocations'

  ListAiNotificationsAdminLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListAiNotificationsAdminFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-ai-notifications-admin'
  # ---------------------------------------------------------------------------
  # MANAGE-NOTIFICATION-RULES ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageNotificationRulesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-notification-rules

  ManageNotificationRulesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageNotificationRulesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageNotificationRulesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageNotificationRulesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageNotificationRulesFunction.Arn}/invocations'

  ManageNotificationRulesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageNotificationRulesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-notification-rules'
  # ---------------------------------------------------------------------------
  # SEND-AI-NOTIFICATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  SendAiNotificationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: send-ai-notification

  SendAiNotificationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendAiNotificationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SendAiNotificationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendAiNotificationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SendAiNotificationFunction.Arn}/invocations'

  SendAiNotificationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SendAiNotificationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/send-ai-notification'
  # ---------------------------------------------------------------------------
  # UPDATE-AI-NOTIFICATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  UpdateAiNotificationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: update-ai-notification

  UpdateAiNotificationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UpdateAiNotificationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  UpdateAiNotificationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UpdateAiNotificationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${UpdateAiNotificationFunction.Arn}/invocations'

  UpdateAiNotificationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref UpdateAiNotificationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/update-ai-notification'
  # ---------------------------------------------------------------------------
  # DELETE-WEBAUTHN-CREDENTIAL ENDPOINT
  # ---------------------------------------------------------------------------
  
  DeleteWebauthnCredentialResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: delete-webauthn-credential

  DeleteWebauthnCredentialOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeleteWebauthnCredentialResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DeleteWebauthnCredentialPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeleteWebauthnCredentialResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DeleteWebauthnCredentialFunction.Arn}/invocations'

  DeleteWebauthnCredentialLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DeleteWebauthnCredentialFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/delete-webauthn-credential'
  # ---------------------------------------------------------------------------
  # FORGOT-PASSWORD ENDPOINT
  # ---------------------------------------------------------------------------
  
  ForgotPasswordResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: forgot-password

  ForgotPasswordOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ForgotPasswordResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ForgotPasswordPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ForgotPasswordResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ForgotPasswordFunction.Arn}/invocations'

  ForgotPasswordLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ForgotPasswordFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/forgot-password'
  # ---------------------------------------------------------------------------
  # MFA-ENROLL ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaEnrollResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-enroll

  MfaEnrollOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaEnrollResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaEnrollPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaEnrollResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaEnrollFunction.Arn}/invocations'

  MfaEnrollLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaEnrollFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-enroll'
  # ---------------------------------------------------------------------------
  # MFA-CHECK ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaCheckResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-check

  MfaCheckOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaCheckResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaCheckPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaCheckResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaCheckFunction.Arn}/invocations'

  MfaCheckLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaCheckFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-check'
  # ---------------------------------------------------------------------------
  # MFA-CHALLENGE-VERIFY ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaChallengeVerifyResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-challenge-verify

  MfaChallengeVerifyOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaChallengeVerifyResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaChallengeVerifyPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaChallengeVerifyResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaChallengeVerifyFunction.Arn}/invocations'

  MfaChallengeVerifyLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaChallengeVerifyFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-challenge-verify'
  # ---------------------------------------------------------------------------
  # MFA-VERIFY-LOGIN ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaVerifyLoginResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-verify-login

  MfaVerifyLoginOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaVerifyLoginResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaVerifyLoginPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaVerifyLoginResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaVerifyLoginFunction.Arn}/invocations'

  MfaVerifyLoginLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaVerifyLoginFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-verify-login'
  # ---------------------------------------------------------------------------
  # MFA-LIST-FACTORS ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaListFactorsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-list-factors

  MfaListFactorsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaListFactorsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaListFactorsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaListFactorsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaListFactorsFunction.Arn}/invocations'

  MfaListFactorsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaListFactorsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-list-factors'
  # ---------------------------------------------------------------------------
  # MFA-UNENROLL ENDPOINT
  # ---------------------------------------------------------------------------
  
  MfaUnenrollResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mfa-unenroll

  MfaUnenrollOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaUnenrollResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MfaUnenrollPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MfaUnenrollResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MfaUnenrollFunction.Arn}/invocations'

  MfaUnenrollLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MfaUnenrollFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mfa-unenroll'
  # ---------------------------------------------------------------------------
  # SELF-REGISTER ENDPOINT
  # ---------------------------------------------------------------------------
  
  SelfRegisterResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: self-register

  SelfRegisterOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SelfRegisterResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SelfRegisterPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SelfRegisterResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SelfRegisterFunction.Arn}/invocations'

  SelfRegisterLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SelfRegisterFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/self-register'
  # ---------------------------------------------------------------------------
  # VERIFY-TV-TOKEN ENDPOINT
  # ---------------------------------------------------------------------------
  
  VerifyTvTokenResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: verify-tv-token

  VerifyTvTokenOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref VerifyTvTokenResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  VerifyTvTokenPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref VerifyTvTokenResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${VerifyTvTokenFunction.Arn}/invocations'

  VerifyTvTokenLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref VerifyTvTokenFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/verify-tv-token'
  # ---------------------------------------------------------------------------
  # WEBAUTHN-AUTHENTICATE ENDPOINT
  # ---------------------------------------------------------------------------
  
  WebauthnAuthenticateResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: webauthn-authenticate

  WebauthnAuthenticateOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnAuthenticateResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WebauthnAuthenticatePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnAuthenticateResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WebauthnAuthenticateFunction.Arn}/invocations'

  WebauthnAuthenticateLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WebauthnAuthenticateFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/webauthn-authenticate'
  # ---------------------------------------------------------------------------
  # WEBAUTHN-CHECK ENDPOINT
  # ---------------------------------------------------------------------------
  
  WebauthnCheckResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: webauthn-check

  WebauthnCheckOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnCheckResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WebauthnCheckPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnCheckResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WebauthnCheckFunction.Arn}/invocations'

  WebauthnCheckLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WebauthnCheckFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/webauthn-check'
  # ---------------------------------------------------------------------------
  # WEBAUTHN-REGISTER ENDPOINT
  # ---------------------------------------------------------------------------
  
  WebauthnRegisterResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: webauthn-register

  WebauthnRegisterOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnRegisterResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WebauthnRegisterPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebauthnRegisterResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WebauthnRegisterFunction.Arn}/invocations'

  WebauthnRegisterLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WebauthnRegisterFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/webauthn-register'
  # ---------------------------------------------------------------------------
  # LIST-AWS-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListAwsCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-aws-credentials

  ListAwsCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAwsCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListAwsCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAwsCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListAwsCredentialsFunction.Arn}/invocations'

  ListAwsCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListAwsCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-aws-credentials'
  # ---------------------------------------------------------------------------
  # SAVE-AWS-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  SaveAwsCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: save-aws-credentials

  SaveAwsCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SaveAwsCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SaveAwsCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SaveAwsCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SaveAwsCredentialsFunction.Arn}/invocations'

  SaveAwsCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SaveAwsCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/save-aws-credentials'
  # ---------------------------------------------------------------------------
  # UPDATE-AWS-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  UpdateAwsCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: update-aws-credentials

  UpdateAwsCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UpdateAwsCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  UpdateAwsCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UpdateAwsCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${UpdateAwsCredentialsFunction.Arn}/invocations'

  UpdateAwsCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref UpdateAwsCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/update-aws-credentials'
  # ---------------------------------------------------------------------------
  # AZURE-ACTIVITY-LOGS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureActivityLogsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-activity-logs

  AzureActivityLogsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureActivityLogsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureActivityLogsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureActivityLogsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureActivityLogsFunction.Arn}/invocations'

  AzureActivityLogsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureActivityLogsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-activity-logs'
  # ---------------------------------------------------------------------------
  # AZURE-COMPLIANCE-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureComplianceScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-compliance-scan

  AzureComplianceScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureComplianceScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureComplianceScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureComplianceScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureComplianceScanFunction.Arn}/invocations'

  AzureComplianceScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureComplianceScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-compliance-scan'
  # ---------------------------------------------------------------------------
  # AZURE-COST-OPTIMIZATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureCostOptimizationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-cost-optimization

  AzureCostOptimizationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureCostOptimizationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureCostOptimizationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureCostOptimizationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureCostOptimizationFunction.Arn}/invocations'

  AzureCostOptimizationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureCostOptimizationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-cost-optimization'
  # ---------------------------------------------------------------------------
  # AZURE-DEFENDER-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureDefenderScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-defender-scan

  AzureDefenderScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureDefenderScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureDefenderScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureDefenderScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureDefenderScanFunction.Arn}/invocations'

  AzureDefenderScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureDefenderScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-defender-scan'
  # ---------------------------------------------------------------------------
  # AZURE-DETECT-ANOMALIES ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureDetectAnomaliesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-detect-anomalies

  AzureDetectAnomaliesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureDetectAnomaliesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureDetectAnomaliesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureDetectAnomaliesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureDetectAnomaliesFunction.Arn}/invocations'

  AzureDetectAnomaliesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureDetectAnomaliesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-detect-anomalies'
  # ---------------------------------------------------------------------------
  # AZURE-FETCH-COSTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureFetchCostsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-fetch-costs

  AzureFetchCostsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchCostsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureFetchCostsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchCostsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureFetchCostsFunction.Arn}/invocations'

  AzureFetchCostsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureFetchCostsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-fetch-costs'
  # ---------------------------------------------------------------------------
  # AZURE-FETCH-EDGE-SERVICES ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureFetchEdgeServicesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-fetch-edge-services

  AzureFetchEdgeServicesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchEdgeServicesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureFetchEdgeServicesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchEdgeServicesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureFetchEdgeServicesFunction.Arn}/invocations'

  AzureFetchEdgeServicesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureFetchEdgeServicesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-fetch-edge-services'
  # ---------------------------------------------------------------------------
  # AZURE-FETCH-MONITOR-METRICS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureFetchMonitorMetricsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-fetch-monitor-metrics

  AzureFetchMonitorMetricsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchMonitorMetricsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureFetchMonitorMetricsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureFetchMonitorMetricsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureFetchMonitorMetricsFunction.Arn}/invocations'

  AzureFetchMonitorMetricsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureFetchMonitorMetricsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-fetch-monitor-metrics'
  # ---------------------------------------------------------------------------
  # AZURE-OAUTH-CALLBACK ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureOauthCallbackResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-oauth-callback

  AzureOauthCallbackOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthCallbackResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureOauthCallbackPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthCallbackResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureOauthCallbackFunction.Arn}/invocations'

  AzureOauthCallbackLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureOauthCallbackFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-oauth-callback'
  # ---------------------------------------------------------------------------
  # AZURE-OAUTH-INITIATE ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureOauthInitiateResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-oauth-initiate

  AzureOauthInitiateOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthInitiateResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureOauthInitiatePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthInitiateResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureOauthInitiateFunction.Arn}/invocations'

  AzureOauthInitiateLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureOauthInitiateFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-oauth-initiate'
  # ---------------------------------------------------------------------------
  # AZURE-OAUTH-REFRESH ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureOauthRefreshResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-oauth-refresh

  AzureOauthRefreshOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthRefreshResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureOauthRefreshPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthRefreshResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureOauthRefreshFunction.Arn}/invocations'

  AzureOauthRefreshLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureOauthRefreshFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-oauth-refresh'
  # ---------------------------------------------------------------------------
  # AZURE-OAUTH-REVOKE ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureOauthRevokeResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-oauth-revoke

  AzureOauthRevokeOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthRevokeResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureOauthRevokePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureOauthRevokeResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureOauthRevokeFunction.Arn}/invocations'

  AzureOauthRevokeLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureOauthRevokeFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-oauth-revoke'
  # ---------------------------------------------------------------------------
  # AZURE-RESERVATIONS-ANALYZER ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureReservationsAnalyzerResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-reservations-analyzer

  AzureReservationsAnalyzerOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureReservationsAnalyzerResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureReservationsAnalyzerPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureReservationsAnalyzerResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureReservationsAnalyzerFunction.Arn}/invocations'

  AzureReservationsAnalyzerLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureReservationsAnalyzerFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-reservations-analyzer'
  # ---------------------------------------------------------------------------
  # AZURE-RESOURCE-INVENTORY ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureResourceInventoryResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-resource-inventory

  AzureResourceInventoryOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureResourceInventoryResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureResourceInventoryPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureResourceInventoryResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureResourceInventoryFunction.Arn}/invocations'

  AzureResourceInventoryLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureResourceInventoryFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-resource-inventory'
  # ---------------------------------------------------------------------------
  # AZURE-SECURITY-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureSecurityScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-security-scan

  AzureSecurityScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureSecurityScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureSecurityScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureSecurityScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureSecurityScanFunction.Arn}/invocations'

  AzureSecurityScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureSecurityScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-security-scan'
  # ---------------------------------------------------------------------------
  # AZURE-WELL-ARCHITECTED-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  AzureWellArchitectedScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: azure-well-architected-scan

  AzureWellArchitectedScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureWellArchitectedScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AzureWellArchitectedScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AzureWellArchitectedScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AzureWellArchitectedScanFunction.Arn}/invocations'

  AzureWellArchitectedScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AzureWellArchitectedScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/azure-well-architected-scan'
  # ---------------------------------------------------------------------------
  # DELETE-AZURE-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  DeleteAzureCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: delete-azure-credentials

  DeleteAzureCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeleteAzureCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DeleteAzureCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DeleteAzureCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DeleteAzureCredentialsFunction.Arn}/invocations'

  DeleteAzureCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DeleteAzureCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/delete-azure-credentials'
  # ---------------------------------------------------------------------------
  # LIST-AZURE-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListAzureCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-azure-credentials

  ListAzureCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAzureCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListAzureCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListAzureCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListAzureCredentialsFunction.Arn}/invocations'

  ListAzureCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListAzureCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-azure-credentials'
  # ---------------------------------------------------------------------------
  # SAVE-AZURE-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  SaveAzureCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: save-azure-credentials

  SaveAzureCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SaveAzureCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SaveAzureCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SaveAzureCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SaveAzureCredentialsFunction.Arn}/invocations'

  SaveAzureCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SaveAzureCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/save-azure-credentials'
  # ---------------------------------------------------------------------------
  # START-AZURE-SECURITY-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  StartAzureSecurityScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: start-azure-security-scan

  StartAzureSecurityScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartAzureSecurityScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StartAzureSecurityScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartAzureSecurityScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StartAzureSecurityScanFunction.Arn}/invocations'

  StartAzureSecurityScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StartAzureSecurityScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/start-azure-security-scan'
  # ---------------------------------------------------------------------------
  # VALIDATE-AZURE-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ValidateAzureCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: validate-azure-credentials

  ValidateAzureCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAzureCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ValidateAzureCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAzureCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ValidateAzureCredentialsFunction.Arn}/invocations'

  ValidateAzureCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ValidateAzureCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/validate-azure-credentials'
  # ---------------------------------------------------------------------------
  # VALIDATE-AZURE-PERMISSIONS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ValidateAzurePermissionsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: validate-azure-permissions

  ValidateAzurePermissionsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAzurePermissionsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ValidateAzurePermissionsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAzurePermissionsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ValidateAzurePermissionsFunction.Arn}/invocations'

  ValidateAzurePermissionsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ValidateAzurePermissionsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/validate-azure-permissions'
  # ---------------------------------------------------------------------------
  # LIST-CLOUD-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListCloudCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-cloud-credentials

  ListCloudCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListCloudCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListCloudCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListCloudCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListCloudCredentialsFunction.Arn}/invocations'

  ListCloudCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListCloudCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-cloud-credentials'
  # ---------------------------------------------------------------------------
  # ANALYZE-RI-SP ENDPOINT
  # ---------------------------------------------------------------------------
  
  AnalyzeRiSpResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: analyze-ri-sp

  AnalyzeRiSpOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AnalyzeRiSpResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AnalyzeRiSpPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AnalyzeRiSpResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AnalyzeRiSpFunction.Arn}/invocations'

  AnalyzeRiSpLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AnalyzeRiSpFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/analyze-ri-sp'
  # ---------------------------------------------------------------------------
  # BUDGET-FORECAST ENDPOINT
  # ---------------------------------------------------------------------------
  
  BudgetForecastResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: budget-forecast

  BudgetForecastOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref BudgetForecastResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  BudgetForecastPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref BudgetForecastResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BudgetForecastFunction.Arn}/invocations'

  BudgetForecastLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref BudgetForecastFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/budget-forecast'
  # ---------------------------------------------------------------------------
  # COST-OPTIMIZATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  CostOptimizationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: cost-optimization

  CostOptimizationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CostOptimizationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CostOptimizationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CostOptimizationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CostOptimizationFunction.Arn}/invocations'

  CostOptimizationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CostOptimizationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/cost-optimization'
  # ---------------------------------------------------------------------------
  # FETCH-DAILY-COSTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  FetchDailyCostsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: fetch-daily-costs

  FetchDailyCostsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchDailyCostsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  FetchDailyCostsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchDailyCostsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FetchDailyCostsFunction.Arn}/invocations'

  FetchDailyCostsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref FetchDailyCostsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/fetch-daily-costs'
  # ---------------------------------------------------------------------------
  # FINOPS-COPILOT ENDPOINT
  # ---------------------------------------------------------------------------
  
  FinopsCopilotResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: finops-copilot

  FinopsCopilotOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FinopsCopilotResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  FinopsCopilotPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FinopsCopilotResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FinopsCopilotFunction.Arn}/invocations'

  FinopsCopilotLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref FinopsCopilotFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/finops-copilot'
  # ---------------------------------------------------------------------------
  # GENERATE-COST-FORECAST ENDPOINT
  # ---------------------------------------------------------------------------
  
  GenerateCostForecastResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-cost-forecast

  GenerateCostForecastOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateCostForecastResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GenerateCostForecastPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateCostForecastResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GenerateCostForecastFunction.Arn}/invocations'

  GenerateCostForecastLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GenerateCostForecastFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-cost-forecast'
  # ---------------------------------------------------------------------------
  # GET-RI-SP-ANALYSIS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetRiSpAnalysisResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-ri-sp-analysis

  GetRiSpAnalysisOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRiSpAnalysisResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetRiSpAnalysisPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRiSpAnalysisResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetRiSpAnalysisFunction.Arn}/invocations'

  GetRiSpAnalysisLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetRiSpAnalysisFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-ri-sp-analysis'
  # ---------------------------------------------------------------------------
  # GET-RI-SP-DATA ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetRiSpDataResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-ri-sp-data

  GetRiSpDataOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRiSpDataResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetRiSpDataPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRiSpDataResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetRiSpDataFunction.Arn}/invocations'

  GetRiSpDataLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetRiSpDataFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-ri-sp-data'
  # ---------------------------------------------------------------------------
  # LIST-RI-SP-HISTORY ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListRiSpHistoryResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-ri-sp-history

  ListRiSpHistoryOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListRiSpHistoryResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListRiSpHistoryPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListRiSpHistoryResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListRiSpHistoryFunction.Arn}/invocations'

  ListRiSpHistoryLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListRiSpHistoryFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-ri-sp-history'
  # ---------------------------------------------------------------------------
  # ML-WASTE-DETECTION ENDPOINT
  # ---------------------------------------------------------------------------
  
  MlWasteDetectionResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: ml-waste-detection

  MlWasteDetectionOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MlWasteDetectionResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MlWasteDetectionPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MlWasteDetectionResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MlWasteDetectionFunction.Arn}/invocations'

  MlWasteDetectionLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MlWasteDetectionFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/ml-waste-detection'
  # ---------------------------------------------------------------------------
  # RI-SP-ANALYZER ENDPOINT
  # ---------------------------------------------------------------------------
  
  RiSpAnalyzerResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: ri-sp-analyzer

  RiSpAnalyzerOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref RiSpAnalyzerResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  RiSpAnalyzerPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref RiSpAnalyzerResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${RiSpAnalyzerFunction.Arn}/invocations'

  RiSpAnalyzerLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref RiSpAnalyzerFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/ri-sp-analyzer'
  # ---------------------------------------------------------------------------
  # GET-EXECUTIVE-DASHBOARD ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetExecutiveDashboardResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-executive-dashboard

  GetExecutiveDashboardOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetExecutiveDashboardResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetExecutiveDashboardPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetExecutiveDashboardResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetExecutiveDashboardFunction.Arn}/invocations'

  GetExecutiveDashboardLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetExecutiveDashboardFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-executive-dashboard'
  # ---------------------------------------------------------------------------
  # GET-EXECUTIVE-DASHBOARD-PUBLIC ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetExecutiveDashboardPublicResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-executive-dashboard-public

  GetExecutiveDashboardPublicOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetExecutiveDashboardPublicResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetExecutiveDashboardPublicPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetExecutiveDashboardPublicResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetExecutiveDashboardPublicFunction.Arn}/invocations'

  GetExecutiveDashboardPublicLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetExecutiveDashboardPublicFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-executive-dashboard-public'
  # ---------------------------------------------------------------------------
  # MANAGE-TV-TOKENS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageTvTokensResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-tv-tokens

  ManageTvTokensOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageTvTokensResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageTvTokensPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageTvTokensResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTvTokensFunction.Arn}/invocations'

  ManageTvTokensLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageTvTokensFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-tv-tokens'
  # ---------------------------------------------------------------------------
  # MANAGE-CLOUD-BUDGET ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageCloudBudgetResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-cloud-budget

  ManageCloudBudgetOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageCloudBudgetResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageCloudBudgetPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageCloudBudgetResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageCloudBudgetFunction.Arn}/invocations'

  ManageCloudBudgetLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageCloudBudgetFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-cloud-budget'
  # ---------------------------------------------------------------------------
  # MUTATE-TABLE ENDPOINT
  # ---------------------------------------------------------------------------
  
  MutateTableResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: mutate-table

  MutateTableOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MutateTableResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MutateTablePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MutateTableResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MutateTableFunction.Arn}/invocations'

  MutateTableLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MutateTableFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/mutate-table'
  # ---------------------------------------------------------------------------
  # QUERY-TABLE ENDPOINT
  # ---------------------------------------------------------------------------
  
  QueryTableResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: query-table

  QueryTableOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref QueryTableResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  QueryTablePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref QueryTableResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${QueryTableFunction.Arn}/invocations'

  QueryTableLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref QueryTableFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/query-table'
  # ---------------------------------------------------------------------------
  # TICKET-ATTACHMENTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  TicketAttachmentsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: ticket-attachments

  TicketAttachmentsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TicketAttachmentsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  TicketAttachmentsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TicketAttachmentsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TicketAttachmentsFunction.Arn}/invocations'

  TicketAttachmentsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref TicketAttachmentsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/ticket-attachments'
  # ---------------------------------------------------------------------------
  # TICKET-MANAGEMENT ENDPOINT
  # ---------------------------------------------------------------------------
  
  TicketManagementResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: ticket-management

  TicketManagementOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TicketManagementResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  TicketManagementPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TicketManagementResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TicketManagementFunction.Arn}/invocations'

  TicketManagementLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref TicketManagementFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/ticket-management'
  # ---------------------------------------------------------------------------
  # CLOUDFORMATION-WEBHOOK ENDPOINT
  # ---------------------------------------------------------------------------
  
  CloudformationWebhookResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: cloudformation-webhook

  CloudformationWebhookOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CloudformationWebhookResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CloudformationWebhookPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CloudformationWebhookResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CloudformationWebhookFunction.Arn}/invocations'

  CloudformationWebhookLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CloudformationWebhookFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/cloudformation-webhook'
  # ---------------------------------------------------------------------------
  # CREATE-JIRA-TICKET ENDPOINT
  # ---------------------------------------------------------------------------
  
  CreateJiraTicketResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: create-jira-ticket

  CreateJiraTicketOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateJiraTicketResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CreateJiraTicketPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateJiraTicketResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateJiraTicketFunction.Arn}/invocations'

  CreateJiraTicketLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CreateJiraTicketFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/create-jira-ticket'
  # ---------------------------------------------------------------------------
  # EXECUTE-SCHEDULED-JOB ENDPOINT
  # ---------------------------------------------------------------------------
  
  ExecuteScheduledJobResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: execute-scheduled-job

  ExecuteScheduledJobOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ExecuteScheduledJobResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ExecuteScheduledJobPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ExecuteScheduledJobResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ExecuteScheduledJobFunction.Arn}/invocations'

  ExecuteScheduledJobLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ExecuteScheduledJobFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/execute-scheduled-job'
  # ---------------------------------------------------------------------------
  # LIST-BACKGROUND-JOBS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ListBackgroundJobsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: list-background-jobs

  ListBackgroundJobsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListBackgroundJobsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ListBackgroundJobsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ListBackgroundJobsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListBackgroundJobsFunction.Arn}/invocations'

  ListBackgroundJobsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ListBackgroundJobsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/list-background-jobs'
  # ---------------------------------------------------------------------------
  # PROCESS-BACKGROUND-JOBS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ProcessBackgroundJobsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: process-background-jobs

  ProcessBackgroundJobsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ProcessBackgroundJobsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ProcessBackgroundJobsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ProcessBackgroundJobsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ProcessBackgroundJobsFunction.Arn}/invocations'

  ProcessBackgroundJobsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ProcessBackgroundJobsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/process-background-jobs'
  # ---------------------------------------------------------------------------
  # SCHEDULED-SCAN-EXECUTOR ENDPOINT
  # ---------------------------------------------------------------------------
  
  ScheduledScanExecutorResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: scheduled-scan-executor

  ScheduledScanExecutorOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ScheduledScanExecutorResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ScheduledScanExecutorPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ScheduledScanExecutorResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ScheduledScanExecutorFunction.Arn}/invocations'

  ScheduledScanExecutorLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ScheduledScanExecutorFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/scheduled-scan-executor'
  # ---------------------------------------------------------------------------
  # INCREMENT-ARTICLE-HELPFUL ENDPOINT
  # ---------------------------------------------------------------------------
  
  IncrementArticleHelpfulResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: increment-article-helpful

  IncrementArticleHelpfulOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IncrementArticleHelpfulResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  IncrementArticleHelpfulPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IncrementArticleHelpfulResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${IncrementArticleHelpfulFunction.Arn}/invocations'

  IncrementArticleHelpfulLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref IncrementArticleHelpfulFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/increment-article-helpful'
  # ---------------------------------------------------------------------------
  # INCREMENT-ARTICLE-VIEWS ENDPOINT
  # ---------------------------------------------------------------------------
  
  IncrementArticleViewsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: increment-article-views

  IncrementArticleViewsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IncrementArticleViewsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  IncrementArticleViewsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IncrementArticleViewsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${IncrementArticleViewsFunction.Arn}/invocations'

  IncrementArticleViewsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref IncrementArticleViewsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/increment-article-views'
  # ---------------------------------------------------------------------------
  # KB-AI-SUGGESTIONS ENDPOINT
  # ---------------------------------------------------------------------------
  
  KbAiSuggestionsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: kb-ai-suggestions

  KbAiSuggestionsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbAiSuggestionsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  KbAiSuggestionsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbAiSuggestionsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${KbAiSuggestionsFunction.Arn}/invocations'

  KbAiSuggestionsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref KbAiSuggestionsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/kb-ai-suggestions'
  # ---------------------------------------------------------------------------
  # KB-ANALYTICS-DASHBOARD ENDPOINT
  # ---------------------------------------------------------------------------
  
  KbAnalyticsDashboardResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: kb-analytics-dashboard

  KbAnalyticsDashboardOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbAnalyticsDashboardResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  KbAnalyticsDashboardPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbAnalyticsDashboardResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${KbAnalyticsDashboardFunction.Arn}/invocations'

  KbAnalyticsDashboardLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref KbAnalyticsDashboardFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/kb-analytics-dashboard'
  # ---------------------------------------------------------------------------
  # KB-EXPORT-PDF ENDPOINT
  # ---------------------------------------------------------------------------
  
  KbExportPdfResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: kb-export-pdf

  KbExportPdfOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbExportPdfResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  KbExportPdfPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref KbExportPdfResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${KbExportPdfFunction.Arn}/invocations'

  KbExportPdfLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref KbExportPdfFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/kb-export-pdf'
  # ---------------------------------------------------------------------------
  # TRACK-ARTICLE-VIEW-DETAILED ENDPOINT
  # ---------------------------------------------------------------------------
  
  TrackArticleViewDetailedResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: track-article-view-detailed

  TrackArticleViewDetailedOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TrackArticleViewDetailedResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  TrackArticleViewDetailedPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref TrackArticleViewDetailedResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${TrackArticleViewDetailedFunction.Arn}/invocations'

  TrackArticleViewDetailedLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref TrackArticleViewDetailedFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/track-article-view-detailed'
  # ---------------------------------------------------------------------------
  # ADMIN-SYNC-LICENSE ENDPOINT
  # ---------------------------------------------------------------------------
  
  AdminSyncLicenseResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: admin-sync-license

  AdminSyncLicenseOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AdminSyncLicenseResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AdminSyncLicensePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AdminSyncLicenseResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AdminSyncLicenseFunction.Arn}/invocations'

  AdminSyncLicenseLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AdminSyncLicenseFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/admin-sync-license'
  # ---------------------------------------------------------------------------
  # CONFIGURE-LICENSE ENDPOINT
  # ---------------------------------------------------------------------------
  
  ConfigureLicenseResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: configure-license

  ConfigureLicenseOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ConfigureLicenseResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ConfigureLicensePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ConfigureLicenseResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ConfigureLicenseFunction.Arn}/invocations'

  ConfigureLicenseLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ConfigureLicenseFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/configure-license'
  # ---------------------------------------------------------------------------
  # MANAGE-SEATS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageSeatsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-seats

  ManageSeatsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageSeatsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageSeatsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageSeatsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageSeatsFunction.Arn}/invocations'

  ManageSeatsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageSeatsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-seats'
  # ---------------------------------------------------------------------------
  # SYNC-LICENSE ENDPOINT
  # ---------------------------------------------------------------------------
  
  SyncLicenseResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: sync-license

  SyncLicenseOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SyncLicenseResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SyncLicensePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SyncLicenseResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SyncLicenseFunction.Arn}/invocations'

  SyncLicenseLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SyncLicenseFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/sync-license'
  # ---------------------------------------------------------------------------
  # VALIDATE-LICENSE ENDPOINT
  # ---------------------------------------------------------------------------
  
  ValidateLicenseResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: validate-license

  ValidateLicenseOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateLicenseResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ValidateLicensePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateLicenseResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ValidateLicenseFunction.Arn}/invocations'

  ValidateLicenseLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ValidateLicenseFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/validate-license'
  # ---------------------------------------------------------------------------
  # DETECT-ANOMALIES ENDPOINT
  # ---------------------------------------------------------------------------
  
  DetectAnomaliesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: detect-anomalies

  DetectAnomaliesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DetectAnomaliesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DetectAnomaliesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DetectAnomaliesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DetectAnomaliesFunction.Arn}/invocations'

  DetectAnomaliesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DetectAnomaliesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/detect-anomalies'
  # ---------------------------------------------------------------------------
  # INTELLIGENT-ALERTS-ANALYZER ENDPOINT
  # ---------------------------------------------------------------------------
  
  IntelligentAlertsAnalyzerResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: intelligent-alerts-analyzer

  IntelligentAlertsAnalyzerOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IntelligentAlertsAnalyzerResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  IntelligentAlertsAnalyzerPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IntelligentAlertsAnalyzerResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${IntelligentAlertsAnalyzerFunction.Arn}/invocations'

  IntelligentAlertsAnalyzerLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref IntelligentAlertsAnalyzerFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/intelligent-alerts-analyzer'
  # ---------------------------------------------------------------------------
  # PREDICT-INCIDENTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  PredictIncidentsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: predict-incidents

  PredictIncidentsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref PredictIncidentsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  PredictIncidentsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref PredictIncidentsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${PredictIncidentsFunction.Arn}/invocations'

  PredictIncidentsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref PredictIncidentsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/predict-incidents'
  # ---------------------------------------------------------------------------
  # ALERTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AlertsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: alerts

  AlertsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AlertsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AlertsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AlertsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AlertsFunction.Arn}/invocations'

  AlertsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AlertsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/alerts'
  # ---------------------------------------------------------------------------
  # AUTO-ALERTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AutoAlertsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: auto-alerts

  AutoAlertsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AutoAlertsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AutoAlertsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AutoAlertsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AutoAlertsFunction.Arn}/invocations'

  AutoAlertsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AutoAlertsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/auto-alerts'
  # ---------------------------------------------------------------------------
  # AWS-REALTIME-METRICS ENDPOINT
  # ---------------------------------------------------------------------------
  
  AwsRealtimeMetricsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: aws-realtime-metrics

  AwsRealtimeMetricsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AwsRealtimeMetricsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AwsRealtimeMetricsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AwsRealtimeMetricsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AwsRealtimeMetricsFunction.Arn}/invocations'

  AwsRealtimeMetricsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AwsRealtimeMetricsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/aws-realtime-metrics'
  # ---------------------------------------------------------------------------
  # CHECK-ALERT-RULES ENDPOINT
  # ---------------------------------------------------------------------------
  
  CheckAlertRulesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: check-alert-rules

  CheckAlertRulesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CheckAlertRulesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CheckAlertRulesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CheckAlertRulesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CheckAlertRulesFunction.Arn}/invocations'

  CheckAlertRulesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CheckAlertRulesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/check-alert-rules'
  # ---------------------------------------------------------------------------
  # ENDPOINT-MONITOR-CHECK ENDPOINT
  # ---------------------------------------------------------------------------
  
  EndpointMonitorCheckResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: endpoint-monitor-check

  EndpointMonitorCheckOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref EndpointMonitorCheckResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  EndpointMonitorCheckPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref EndpointMonitorCheckResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${EndpointMonitorCheckFunction.Arn}/invocations'

  EndpointMonitorCheckLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref EndpointMonitorCheckFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/endpoint-monitor-check'
  # ---------------------------------------------------------------------------
  # FETCH-CLOUDWATCH-METRICS ENDPOINT
  # ---------------------------------------------------------------------------
  
  FetchCloudwatchMetricsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: fetch-cloudwatch-metrics

  FetchCloudwatchMetricsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchCloudwatchMetricsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  FetchCloudwatchMetricsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchCloudwatchMetricsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FetchCloudwatchMetricsFunction.Arn}/invocations'

  FetchCloudwatchMetricsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref FetchCloudwatchMetricsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/fetch-cloudwatch-metrics'
  # ---------------------------------------------------------------------------
  # FETCH-EDGE-SERVICES ENDPOINT
  # ---------------------------------------------------------------------------
  
  FetchEdgeServicesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: fetch-edge-services

  FetchEdgeServicesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchEdgeServicesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  FetchEdgeServicesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchEdgeServicesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FetchEdgeServicesFunction.Arn}/invocations'

  FetchEdgeServicesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref FetchEdgeServicesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/fetch-edge-services'
  # ---------------------------------------------------------------------------
  # GENERATE-ERROR-FIX-PROMPT ENDPOINT
  # ---------------------------------------------------------------------------
  
  GenerateErrorFixPromptResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-error-fix-prompt

  GenerateErrorFixPromptOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateErrorFixPromptResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GenerateErrorFixPromptPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateErrorFixPromptResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GenerateErrorFixPromptFunction.Arn}/invocations'

  GenerateErrorFixPromptLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GenerateErrorFixPromptFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-error-fix-prompt'
  # ---------------------------------------------------------------------------
  # GET-LAMBDA-HEALTH ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetLambdaHealthResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-lambda-health

  GetLambdaHealthOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetLambdaHealthResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetLambdaHealthPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetLambdaHealthResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetLambdaHealthFunction.Arn}/invocations'

  GetLambdaHealthLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetLambdaHealthFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-lambda-health'
  # ---------------------------------------------------------------------------
  # GET-PLATFORM-METRICS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetPlatformMetricsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-platform-metrics

  GetPlatformMetricsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetPlatformMetricsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetPlatformMetricsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetPlatformMetricsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetPlatformMetricsFunction.Arn}/invocations'

  GetPlatformMetricsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetPlatformMetricsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-platform-metrics'
  # ---------------------------------------------------------------------------
  # GET-RECENT-ERRORS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetRecentErrorsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-recent-errors

  GetRecentErrorsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRecentErrorsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetRecentErrorsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetRecentErrorsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetRecentErrorsFunction.Arn}/invocations'

  GetRecentErrorsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetRecentErrorsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-recent-errors'
  # ---------------------------------------------------------------------------
  # LOG-FRONTEND-ERROR ENDPOINT
  # ---------------------------------------------------------------------------
  
  LogFrontendErrorResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: log-frontend-error

  LogFrontendErrorOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LogFrontendErrorResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  LogFrontendErrorPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LogFrontendErrorResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LogFrontendErrorFunction.Arn}/invocations'

  LogFrontendErrorLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref LogFrontendErrorFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/log-frontend-error'
  # ---------------------------------------------------------------------------
  # MONITORED-ENDPOINTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  MonitoredEndpointsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: monitored-endpoints

  MonitoredEndpointsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MonitoredEndpointsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  MonitoredEndpointsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref MonitoredEndpointsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${MonitoredEndpointsFunction.Arn}/invocations'

  MonitoredEndpointsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref MonitoredEndpointsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/monitored-endpoints'
  # ---------------------------------------------------------------------------
  # GET-COMMUNICATION-LOGS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetCommunicationLogsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-communication-logs

  GetCommunicationLogsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetCommunicationLogsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetCommunicationLogsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetCommunicationLogsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetCommunicationLogsFunction.Arn}/invocations'

  GetCommunicationLogsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetCommunicationLogsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-communication-logs'
  # ---------------------------------------------------------------------------
  # MANAGE-EMAIL-PREFERENCES ENDPOINT
  # ---------------------------------------------------------------------------
  
  ManageEmailPreferencesResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: manage-email-preferences

  ManageEmailPreferencesOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageEmailPreferencesResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ManageEmailPreferencesPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ManageEmailPreferencesResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageEmailPreferencesFunction.Arn}/invocations'

  ManageEmailPreferencesLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ManageEmailPreferencesFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/manage-email-preferences'
  # ---------------------------------------------------------------------------
  # SEND-EMAIL ENDPOINT
  # ---------------------------------------------------------------------------
  
  SendEmailResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: send-email

  SendEmailOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendEmailResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SendEmailPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendEmailResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SendEmailFunction.Arn}/invocations'

  SendEmailLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SendEmailFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/send-email'
  # ---------------------------------------------------------------------------
  # SEND-NOTIFICATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  SendNotificationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: send-notification

  SendNotificationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendNotificationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SendNotificationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SendNotificationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SendNotificationFunction.Arn}/invocations'

  SendNotificationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SendNotificationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/send-notification'
  # ---------------------------------------------------------------------------
  # CREATE-ORGANIZATION-ACCOUNT ENDPOINT
  # ---------------------------------------------------------------------------
  
  CreateOrganizationAccountResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: create-organization-account

  CreateOrganizationAccountOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateOrganizationAccountResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CreateOrganizationAccountPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateOrganizationAccountResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateOrganizationAccountFunction.Arn}/invocations'

  CreateOrganizationAccountLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CreateOrganizationAccountFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/create-organization-account'
  # ---------------------------------------------------------------------------
  # SYNC-ORGANIZATION-ACCOUNTS ENDPOINT
  # ---------------------------------------------------------------------------
  
  SyncOrganizationAccountsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: sync-organization-accounts

  SyncOrganizationAccountsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SyncOrganizationAccountsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SyncOrganizationAccountsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SyncOrganizationAccountsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SyncOrganizationAccountsFunction.Arn}/invocations'

  SyncOrganizationAccountsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SyncOrganizationAccountsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/sync-organization-accounts'
  # ---------------------------------------------------------------------------
  # CHECK-ORGANIZATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  CheckOrganizationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: check-organization

  CheckOrganizationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CheckOrganizationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CheckOrganizationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CheckOrganizationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CheckOrganizationFunction.Arn}/invocations'

  CheckOrganizationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CheckOrganizationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/check-organization'
  # ---------------------------------------------------------------------------
  # CREATE-WITH-ORGANIZATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  CreateWithOrganizationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: create-with-organization

  CreateWithOrganizationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateWithOrganizationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  CreateWithOrganizationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref CreateWithOrganizationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateWithOrganizationFunction.Arn}/invocations'

  CreateWithOrganizationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref CreateWithOrganizationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/create-with-organization'
  # ---------------------------------------------------------------------------
  # GET-USER-ORGANIZATION ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetUserOrganizationResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-user-organization

  GetUserOrganizationOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetUserOrganizationResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetUserOrganizationPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetUserOrganizationResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetUserOrganizationFunction.Arn}/invocations'

  GetUserOrganizationLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetUserOrganizationFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-user-organization'
  # ---------------------------------------------------------------------------
  # GENERATE-EXCEL-REPORT ENDPOINT
  # ---------------------------------------------------------------------------
  
  GenerateExcelReportResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-excel-report

  GenerateExcelReportOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateExcelReportResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GenerateExcelReportPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateExcelReportResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GenerateExcelReportFunction.Arn}/invocations'

  GenerateExcelReportLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GenerateExcelReportFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-excel-report'
  # ---------------------------------------------------------------------------
  # GENERATE-PDF-REPORT ENDPOINT
  # ---------------------------------------------------------------------------
  
  GeneratePdfReportResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-pdf-report

  GeneratePdfReportOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GeneratePdfReportResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GeneratePdfReportPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GeneratePdfReportResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GeneratePdfReportFunction.Arn}/invocations'

  GeneratePdfReportLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GeneratePdfReportFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-pdf-report'
  # ---------------------------------------------------------------------------
  # GENERATE-REMEDIATION-SCRIPT ENDPOINT
  # ---------------------------------------------------------------------------
  
  GenerateRemediationScriptResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-remediation-script

  GenerateRemediationScriptOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateRemediationScriptResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GenerateRemediationScriptPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateRemediationScriptResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GenerateRemediationScriptFunction.Arn}/invocations'

  GenerateRemediationScriptLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GenerateRemediationScriptFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-remediation-script'
  # ---------------------------------------------------------------------------
  # GENERATE-SECURITY-PDF ENDPOINT
  # ---------------------------------------------------------------------------
  
  GenerateSecurityPdfResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: generate-security-pdf

  GenerateSecurityPdfOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateSecurityPdfResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GenerateSecurityPdfPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GenerateSecurityPdfResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GenerateSecurityPdfFunction.Arn}/invocations'

  GenerateSecurityPdfLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GenerateSecurityPdfFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/generate-security-pdf'
  # ---------------------------------------------------------------------------
  # SECURITY-SCAN-PDF-EXPORT ENDPOINT
  # ---------------------------------------------------------------------------
  
  SecurityScanPdfExportResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: security-scan-pdf-export

  SecurityScanPdfExportOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SecurityScanPdfExportResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SecurityScanPdfExportPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SecurityScanPdfExportResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SecurityScanPdfExportFunction.Arn}/invocations'

  SecurityScanPdfExportLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SecurityScanPdfExportFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/security-scan-pdf-export'
  # ---------------------------------------------------------------------------
  # ANALYZE-CLOUDTRAIL ENDPOINT
  # ---------------------------------------------------------------------------
  
  AnalyzeCloudtrailResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: analyze-cloudtrail

  AnalyzeCloudtrailOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AnalyzeCloudtrailResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  AnalyzeCloudtrailPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref AnalyzeCloudtrailResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AnalyzeCloudtrailFunction.Arn}/invocations'

  AnalyzeCloudtrailLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref AnalyzeCloudtrailFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/analyze-cloudtrail'
  # ---------------------------------------------------------------------------
  # COMPLIANCE-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  ComplianceScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: compliance-scan

  ComplianceScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ComplianceScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ComplianceScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ComplianceScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ComplianceScanFunction.Arn}/invocations'

  ComplianceScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ComplianceScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/compliance-scan'
  # ---------------------------------------------------------------------------
  # DRIFT-DETECTION ENDPOINT
  # ---------------------------------------------------------------------------
  
  DriftDetectionResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: drift-detection

  DriftDetectionOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DriftDetectionResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DriftDetectionPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DriftDetectionResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DriftDetectionFunction.Arn}/invocations'

  DriftDetectionLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DriftDetectionFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/drift-detection'
  # ---------------------------------------------------------------------------
  # FETCH-CLOUDTRAIL ENDPOINT
  # ---------------------------------------------------------------------------
  
  FetchCloudtrailResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: fetch-cloudtrail

  FetchCloudtrailOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchCloudtrailResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  FetchCloudtrailPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref FetchCloudtrailResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${FetchCloudtrailFunction.Arn}/invocations'

  FetchCloudtrailLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref FetchCloudtrailFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/fetch-cloudtrail'
  # ---------------------------------------------------------------------------
  # GET-COMPLIANCE-HISTORY ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetComplianceHistoryResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-compliance-history

  GetComplianceHistoryOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetComplianceHistoryResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetComplianceHistoryPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetComplianceHistoryResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetComplianceHistoryFunction.Arn}/invocations'

  GetComplianceHistoryLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetComplianceHistoryFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-compliance-history'
  # ---------------------------------------------------------------------------
  # GET-COMPLIANCE-SCAN-STATUS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetComplianceScanStatusResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-compliance-scan-status

  GetComplianceScanStatusOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetComplianceScanStatusResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetComplianceScanStatusPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetComplianceScanStatusResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetComplianceScanStatusFunction.Arn}/invocations'

  GetComplianceScanStatusLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetComplianceScanStatusFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-compliance-scan-status'
  # ---------------------------------------------------------------------------
  # GET-FINDINGS ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetFindingsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-findings

  GetFindingsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetFindingsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetFindingsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetFindingsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetFindingsFunction.Arn}/invocations'

  GetFindingsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetFindingsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-findings'
  # ---------------------------------------------------------------------------
  # GET-SECURITY-POSTURE ENDPOINT
  # ---------------------------------------------------------------------------
  
  GetSecurityPostureResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: get-security-posture

  GetSecurityPostureOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetSecurityPostureResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GetSecurityPosturePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GetSecurityPostureResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GetSecurityPostureFunction.Arn}/invocations'

  GetSecurityPostureLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GetSecurityPostureFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/get-security-posture'
  # ---------------------------------------------------------------------------
  # GUARDDUTY-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  GuarddutyScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: guardduty-scan

  GuarddutyScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GuarddutyScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  GuarddutyScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref GuarddutyScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${GuarddutyScanFunction.Arn}/invocations'

  GuarddutyScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref GuarddutyScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/guardduty-scan'
  # ---------------------------------------------------------------------------
  # IAM-DEEP-ANALYSIS ENDPOINT
  # ---------------------------------------------------------------------------
  
  IamDeepAnalysisResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: iam-deep-analysis

  IamDeepAnalysisOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IamDeepAnalysisResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  IamDeepAnalysisPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref IamDeepAnalysisResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${IamDeepAnalysisFunction.Arn}/invocations'

  IamDeepAnalysisLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref IamDeepAnalysisFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/iam-deep-analysis'
  # ---------------------------------------------------------------------------
  # LATERAL-MOVEMENT-DETECTION ENDPOINT
  # ---------------------------------------------------------------------------
  
  LateralMovementDetectionResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: lateral-movement-detection

  LateralMovementDetectionOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LateralMovementDetectionResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  LateralMovementDetectionPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref LateralMovementDetectionResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LateralMovementDetectionFunction.Arn}/invocations'

  LateralMovementDetectionLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref LateralMovementDetectionFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/lateral-movement-detection'
  # ---------------------------------------------------------------------------
  # SECURITY-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  SecurityScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: security-scan

  SecurityScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SecurityScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  SecurityScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref SecurityScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SecurityScanFunction.Arn}/invocations'

  SecurityScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref SecurityScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/security-scan'
  # ---------------------------------------------------------------------------
  # START-CLOUDTRAIL-ANALYSIS ENDPOINT
  # ---------------------------------------------------------------------------
  
  StartCloudtrailAnalysisResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: start-cloudtrail-analysis

  StartCloudtrailAnalysisOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartCloudtrailAnalysisResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StartCloudtrailAnalysisPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartCloudtrailAnalysisResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StartCloudtrailAnalysisFunction.Arn}/invocations'

  StartCloudtrailAnalysisLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StartCloudtrailAnalysisFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/start-cloudtrail-analysis'
  # ---------------------------------------------------------------------------
  # START-COMPLIANCE-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  StartComplianceScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: start-compliance-scan

  StartComplianceScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartComplianceScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StartComplianceScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartComplianceScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StartComplianceScanFunction.Arn}/invocations'

  StartComplianceScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StartComplianceScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/start-compliance-scan'
  # ---------------------------------------------------------------------------
  # START-SECURITY-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  StartSecurityScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: start-security-scan

  StartSecurityScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartSecurityScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StartSecurityScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StartSecurityScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StartSecurityScanFunction.Arn}/invocations'

  StartSecurityScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StartSecurityScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/start-security-scan'
  # ---------------------------------------------------------------------------
  # VALIDATE-AWS-CREDENTIALS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ValidateAwsCredentialsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: validate-aws-credentials

  ValidateAwsCredentialsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAwsCredentialsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ValidateAwsCredentialsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidateAwsCredentialsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ValidateAwsCredentialsFunction.Arn}/invocations'

  ValidateAwsCredentialsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ValidateAwsCredentialsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/validate-aws-credentials'
  # ---------------------------------------------------------------------------
  # VALIDATE-PERMISSIONS ENDPOINT
  # ---------------------------------------------------------------------------
  
  ValidatePermissionsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: validate-permissions

  ValidatePermissionsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidatePermissionsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  ValidatePermissionsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref ValidatePermissionsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ValidatePermissionsFunction.Arn}/invocations'

  ValidatePermissionsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref ValidatePermissionsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/validate-permissions'
  # ---------------------------------------------------------------------------
  # WAF-DASHBOARD-API ENDPOINT
  # ---------------------------------------------------------------------------
  
  WafDashboardApiResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: waf-dashboard-api

  WafDashboardApiOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WafDashboardApiResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WafDashboardApiPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WafDashboardApiResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WafDashboardApiFunction.Arn}/invocations'

  WafDashboardApiLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WafDashboardApiFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/waf-dashboard-api'
  # ---------------------------------------------------------------------------
  # WAF-SETUP-MONITORING ENDPOINT
  # ---------------------------------------------------------------------------
  
  WafSetupMonitoringResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: waf-setup-monitoring

  WafSetupMonitoringOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WafSetupMonitoringResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WafSetupMonitoringPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WafSetupMonitoringResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WafSetupMonitoringFunction.Arn}/invocations'

  WafSetupMonitoringLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WafSetupMonitoringFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/waf-setup-monitoring'
  # ---------------------------------------------------------------------------
  # WELL-ARCHITECTED-SCAN ENDPOINT
  # ---------------------------------------------------------------------------
  
  WellArchitectedScanResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: well-architected-scan

  WellArchitectedScanOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WellArchitectedScanResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WellArchitectedScanPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WellArchitectedScanResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WellArchitectedScanFunction.Arn}/invocations'

  WellArchitectedScanLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WellArchitectedScanFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/well-architected-scan'
  # ---------------------------------------------------------------------------
  # STORAGE-DOWNLOAD ENDPOINT
  # ---------------------------------------------------------------------------
  
  StorageDownloadResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: storage-download

  StorageDownloadOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StorageDownloadResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StorageDownloadPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StorageDownloadResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StorageDownloadFunction.Arn}/invocations'

  StorageDownloadLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StorageDownloadFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/storage-download'
  # ---------------------------------------------------------------------------
  # STORAGE-DELETE ENDPOINT
  # ---------------------------------------------------------------------------
  
  StorageDeleteResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: storage-delete

  StorageDeleteOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StorageDeleteResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  StorageDeletePostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref StorageDeleteResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${StorageDeleteFunction.Arn}/invocations'

  StorageDeleteLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref StorageDeleteFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/storage-delete'
  # ---------------------------------------------------------------------------
  # UPLOAD-ATTACHMENT ENDPOINT
  # ---------------------------------------------------------------------------
  
  UploadAttachmentResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: upload-attachment

  UploadAttachmentOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UploadAttachmentResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  UploadAttachmentPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref UploadAttachmentResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${UploadAttachmentFunction.Arn}/invocations'

  UploadAttachmentLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref UploadAttachmentFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/upload-attachment'
  # ---------------------------------------------------------------------------
  # DB-INIT ENDPOINT
  # ---------------------------------------------------------------------------
  
  DbInitResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: db-init

  DbInitOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DbInitResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  DbInitPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref DbInitResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${DbInitFunction.Arn}/invocations'

  DbInitLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref DbInitFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/db-init'
  # ---------------------------------------------------------------------------
  # NOTIFICATION-SETTINGS ENDPOINT
  # ---------------------------------------------------------------------------
  
  NotificationSettingsResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: notification-settings

  NotificationSettingsOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref NotificationSettingsResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  NotificationSettingsPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref NotificationSettingsResource
      HttpMethod: POST
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId: !Ref AuthorizerId
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${NotificationSettingsFunction.Arn}/invocations'

  NotificationSettingsLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref NotificationSettingsFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/notification-settings'
  # ---------------------------------------------------------------------------
  # WEBSOCKET-CONNECT ENDPOINT
  # ---------------------------------------------------------------------------
  
  WebsocketConnectResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: websocket-connect

  WebsocketConnectOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebsocketConnectResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WebsocketConnectPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebsocketConnectResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WebsocketConnectFunction.Arn}/invocations'

  WebsocketConnectLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WebsocketConnectFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/websocket-connect'
  # ---------------------------------------------------------------------------
  # WEBSOCKET-DISCONNECT ENDPOINT
  # ---------------------------------------------------------------------------
  
  WebsocketDisconnectResource:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref RestApiId
      ParentId: !Ref FunctionsResourceId
      PathPart: websocket-disconnect

  WebsocketDisconnectOptionsMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebsocketDisconnectResource
      HttpMethod: OPTIONS
      AuthorizationType: NONE
      Integration:
        Type: MOCK
        RequestTemplates:
          application/json: '{"statusCode": 200}'
        IntegrationResponses:
          - StatusCode: 200
            ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,Authorization,X-Requested-With,X-API-Key,X-Request-ID,X-CSRF-Token,X-Correlation-ID,X-Amz-Date,X-Amz-Security-Token,X-Impersonate-Organization'"
              method.response.header.Access-Control-Allow-Methods: "'GET,POST,PUT,DELETE,OPTIONS'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
      MethodResponses:
        - StatusCode: 200
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true

  WebsocketDisconnectPostMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      RestApiId: !Ref RestApiId
      ResourceId: !Ref WebsocketDisconnectResource
      HttpMethod: POST
      AuthorizationType: NONE
      Integration:
        Type: AWS_PROXY
        IntegrationHttpMethod: POST
        Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${WebsocketDisconnectFunction.Arn}/invocations'

  WebsocketDisconnectLambdaPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref WebsocketDisconnectFunction
      Action: lambda:InvokeFunction
      Principal: apigateway.amazonaws.com
      SourceArn: !Sub 'arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${RestApiId}/*/POST/api/functions/websocket-disconnect'

# =============================================================================
# OUTPUTS
# =============================================================================

Outputs:
  TotalLambdaFunctions:
    Description: Total number of Lambda functions created
    Value: '203'

  TotalApiEndpoints:
    Description: Total number of API Gateway endpoints created
    Value: '146'

  TotalScheduledHandlers:
    Description: Total number of scheduled/internal handlers
    Value: '57'

  AdminManageUserFunctionArn:
    Description: ARN of admin-manage-user Lambda function
    Value: !GetAtt AdminManageUserFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-admin-manage-user-arn'
  AutomatedCleanupStuckScansFunctionArn:
    Description: ARN of automated-cleanup-stuck-scans Lambda function
    Value: !GetAtt AutomatedCleanupStuckScansFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-automated-cleanup-stuck-scans-arn'
  CheckCloudtrailStatusFunctionArn:
    Description: ARN of check-cloudtrail-status Lambda function
    Value: !GetAtt CheckCloudtrailStatusFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-cloudtrail-status-arn'
  CheckCostsFunctionArn:
    Description: ARN of check-costs Lambda function
    Value: !GetAtt CheckCostsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-costs-arn'
  CleanupStuckScansFunctionArn:
    Description: ARN of cleanup-stuck-scans Lambda function
    Value: !GetAtt CleanupStuckScansFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans-arn'
  CreateCognitoUserFunctionArn:
    Description: ARN of create-cognito-user Lambda function
    Value: !GetAtt CreateCognitoUserFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-cognito-user-arn'
  CreateUserFunctionArn:
    Description: ARN of create-user Lambda function
    Value: !GetAtt CreateUserFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-user-arn'
  DeactivateDemoModeFunctionArn:
    Description: ARN of deactivate-demo-mode Lambda function
    Value: !GetAtt DeactivateDemoModeFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-deactivate-demo-mode-arn'
  DebugCloudtrailFunctionArn:
    Description: ARN of debug-cloudtrail Lambda function
    Value: !GetAtt DebugCloudtrailFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-debug-cloudtrail-arn'
  DirectCleanupFunctionArn:
    Description: ARN of direct-cleanup Lambda function
    Value: !GetAtt DirectCleanupFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-direct-cleanup-arn'
  DisableCognitoUserFunctionArn:
    Description: ARN of disable-cognito-user Lambda function
    Value: !GetAtt DisableCognitoUserFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-disable-cognito-user-arn'
  FixRoleArnMigrationFunctionArn:
    Description: ARN of fix-role-arn-migration Lambda function
    Value: !GetAtt FixRoleArnMigrationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fix-role-arn-migration-arn'
  LogAuditFunctionArn:
    Description: ARN of log-audit Lambda function
    Value: !GetAtt LogAuditFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-log-audit-arn'
  ManageDemoModeFunctionArn:
    Description: ARN of manage-demo-mode Lambda function
    Value: !GetAtt ManageDemoModeFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-demo-mode-arn'
  ManageEmailTemplatesFunctionArn:
    Description: ARN of manage-email-templates Lambda function
    Value: !GetAtt ManageEmailTemplatesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-email-templates-arn'
  ManageOrganizationsFunctionArn:
    Description: ARN of manage-organizations Lambda function
    Value: !GetAtt ManageOrganizationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-organizations-arn'
  RunMigrationFunctionArn:
    Description: ARN of run-migration Lambda function
    Value: !GetAtt RunMigrationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-run-migration-arn'
  RunMigrationStandaloneFunctionArn:
    Description: ARN of run-migration-standalone Lambda function
    Value: !GetAtt RunMigrationStandaloneFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-run-migration-standalone-arn'
  RunSqlFunctionArn:
    Description: ARN of run-sql Lambda function
    Value: !GetAtt RunSqlFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-run-sql-arn'
  SetupLicenseConfigFunctionArn:
    Description: ARN of setup-license-config Lambda function
    Value: !GetAtt SetupLicenseConfigFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-setup-license-config-arn'
  BedrockChatFunctionArn:
    Description: ARN of bedrock-chat Lambda function
    Value: !GetAtt BedrockChatFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-bedrock-chat-arn'
  CheckProactiveNotificationsFunctionArn:
    Description: ARN of check-proactive-notifications Lambda function
    Value: !GetAtt CheckProactiveNotificationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-proactive-notifications-arn'
  GenerateResponseFunctionArn:
    Description: ARN of generate-response Lambda function
    Value: !GetAtt GenerateResponseFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-response-arn'
  GetAiNotificationsFunctionArn:
    Description: ARN of get-ai-notifications Lambda function
    Value: !GetAtt GetAiNotificationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-ai-notifications-arn'
  ListAiNotificationsAdminFunctionArn:
    Description: ARN of list-ai-notifications-admin Lambda function
    Value: !GetAtt ListAiNotificationsAdminFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-ai-notifications-admin-arn'
  ManageNotificationRulesFunctionArn:
    Description: ARN of manage-notification-rules Lambda function
    Value: !GetAtt ManageNotificationRulesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-notification-rules-arn'
  SendAiNotificationFunctionArn:
    Description: ARN of send-ai-notification Lambda function
    Value: !GetAtt SendAiNotificationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-send-ai-notification-arn'
  UpdateAiNotificationFunctionArn:
    Description: ARN of update-ai-notification Lambda function
    Value: !GetAtt UpdateAiNotificationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-update-ai-notification-arn'
  DeleteWebauthnCredentialFunctionArn:
    Description: ARN of delete-webauthn-credential Lambda function
    Value: !GetAtt DeleteWebauthnCredentialFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-delete-webauthn-credential-arn'
  DeleteWebauthnCredentialAdminFunctionArn:
    Description: ARN of delete-webauthn-credential-admin Lambda function
    Value: !GetAtt DeleteWebauthnCredentialAdminFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-delete-webauthn-credential-admin-arn'
  ForgotPasswordFunctionArn:
    Description: ARN of forgot-password Lambda function
    Value: !GetAtt ForgotPasswordFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-forgot-password-arn'
  MfaEnrollFunctionArn:
    Description: ARN of mfa-enroll Lambda function
    Value: !GetAtt MfaEnrollFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-enroll-arn'
  MfaCheckFunctionArn:
    Description: ARN of mfa-check Lambda function
    Value: !GetAtt MfaCheckFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-check-arn'
  MfaChallengeVerifyFunctionArn:
    Description: ARN of mfa-challenge-verify Lambda function
    Value: !GetAtt MfaChallengeVerifyFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-challenge-verify-arn'
  MfaVerifyLoginFunctionArn:
    Description: ARN of mfa-verify-login Lambda function
    Value: !GetAtt MfaVerifyLoginFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-verify-login-arn'
  MfaListFactorsFunctionArn:
    Description: ARN of mfa-list-factors Lambda function
    Value: !GetAtt MfaListFactorsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-list-factors-arn'
  MfaUnenrollFunctionArn:
    Description: ARN of mfa-unenroll Lambda function
    Value: !GetAtt MfaUnenrollFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mfa-unenroll-arn'
  SelfRegisterFunctionArn:
    Description: ARN of self-register Lambda function
    Value: !GetAtt SelfRegisterFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-self-register-arn'
  VerifyTvTokenFunctionArn:
    Description: ARN of verify-tv-token Lambda function
    Value: !GetAtt VerifyTvTokenFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-verify-tv-token-arn'
  WebauthnAuthenticateFunctionArn:
    Description: ARN of webauthn-authenticate Lambda function
    Value: !GetAtt WebauthnAuthenticateFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-webauthn-authenticate-arn'
  WebauthnCheckFunctionArn:
    Description: ARN of webauthn-check Lambda function
    Value: !GetAtt WebauthnCheckFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-webauthn-check-arn'
  WebauthnRegisterFunctionArn:
    Description: ARN of webauthn-register Lambda function
    Value: !GetAtt WebauthnRegisterFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-webauthn-register-arn'
  ListAwsCredentialsFunctionArn:
    Description: ARN of list-aws-credentials Lambda function
    Value: !GetAtt ListAwsCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-aws-credentials-arn'
  SaveAwsCredentialsFunctionArn:
    Description: ARN of save-aws-credentials Lambda function
    Value: !GetAtt SaveAwsCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-save-aws-credentials-arn'
  UpdateAwsCredentialsFunctionArn:
    Description: ARN of update-aws-credentials Lambda function
    Value: !GetAtt UpdateAwsCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-update-aws-credentials-arn'
  AzureActivityLogsFunctionArn:
    Description: ARN of azure-activity-logs Lambda function
    Value: !GetAtt AzureActivityLogsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-activity-logs-arn'
  AzureComplianceScanFunctionArn:
    Description: ARN of azure-compliance-scan Lambda function
    Value: !GetAtt AzureComplianceScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-compliance-scan-arn'
  AzureCostOptimizationFunctionArn:
    Description: ARN of azure-cost-optimization Lambda function
    Value: !GetAtt AzureCostOptimizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-cost-optimization-arn'
  AzureDefenderScanFunctionArn:
    Description: ARN of azure-defender-scan Lambda function
    Value: !GetAtt AzureDefenderScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-defender-scan-arn'
  AzureDetectAnomaliesFunctionArn:
    Description: ARN of azure-detect-anomalies Lambda function
    Value: !GetAtt AzureDetectAnomaliesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-detect-anomalies-arn'
  AzureFetchCostsFunctionArn:
    Description: ARN of azure-fetch-costs Lambda function
    Value: !GetAtt AzureFetchCostsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-fetch-costs-arn'
  AzureFetchEdgeServicesFunctionArn:
    Description: ARN of azure-fetch-edge-services Lambda function
    Value: !GetAtt AzureFetchEdgeServicesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-fetch-edge-services-arn'
  AzureFetchMonitorMetricsFunctionArn:
    Description: ARN of azure-fetch-monitor-metrics Lambda function
    Value: !GetAtt AzureFetchMonitorMetricsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-fetch-monitor-metrics-arn'
  AzureOauthCallbackFunctionArn:
    Description: ARN of azure-oauth-callback Lambda function
    Value: !GetAtt AzureOauthCallbackFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-oauth-callback-arn'
  AzureOauthInitiateFunctionArn:
    Description: ARN of azure-oauth-initiate Lambda function
    Value: !GetAtt AzureOauthInitiateFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-oauth-initiate-arn'
  AzureOauthRefreshFunctionArn:
    Description: ARN of azure-oauth-refresh Lambda function
    Value: !GetAtt AzureOauthRefreshFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-oauth-refresh-arn'
  AzureOauthRevokeFunctionArn:
    Description: ARN of azure-oauth-revoke Lambda function
    Value: !GetAtt AzureOauthRevokeFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-oauth-revoke-arn'
  AzureReservationsAnalyzerFunctionArn:
    Description: ARN of azure-reservations-analyzer Lambda function
    Value: !GetAtt AzureReservationsAnalyzerFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-reservations-analyzer-arn'
  AzureResourceInventoryFunctionArn:
    Description: ARN of azure-resource-inventory Lambda function
    Value: !GetAtt AzureResourceInventoryFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-resource-inventory-arn'
  AzureSecurityScanFunctionArn:
    Description: ARN of azure-security-scan Lambda function
    Value: !GetAtt AzureSecurityScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-security-scan-arn'
  AzureWellArchitectedScanFunctionArn:
    Description: ARN of azure-well-architected-scan Lambda function
    Value: !GetAtt AzureWellArchitectedScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-azure-well-architected-scan-arn'
  DebugAzureCostsFunctionArn:
    Description: ARN of debug-azure-costs Lambda function
    Value: !GetAtt DebugAzureCostsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-debug-azure-costs-arn'
  DeleteAzureCredentialsFunctionArn:
    Description: ARN of delete-azure-credentials Lambda function
    Value: !GetAtt DeleteAzureCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-delete-azure-credentials-arn'
  ListAzureCredentialsFunctionArn:
    Description: ARN of list-azure-credentials Lambda function
    Value: !GetAtt ListAzureCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-azure-credentials-arn'
  SaveAzureCredentialsFunctionArn:
    Description: ARN of save-azure-credentials Lambda function
    Value: !GetAtt SaveAzureCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-save-azure-credentials-arn'
  StartAzureSecurityScanFunctionArn:
    Description: ARN of start-azure-security-scan Lambda function
    Value: !GetAtt StartAzureSecurityScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-start-azure-security-scan-arn'
  ValidateAzureCredentialsFunctionArn:
    Description: ARN of validate-azure-credentials Lambda function
    Value: !GetAtt ValidateAzureCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-azure-credentials-arn'
  ValidateAzurePermissionsFunctionArn:
    Description: ARN of validate-azure-permissions Lambda function
    Value: !GetAtt ValidateAzurePermissionsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-azure-permissions-arn'
  ListCloudCredentialsFunctionArn:
    Description: ARN of list-cloud-credentials Lambda function
    Value: !GetAtt ListCloudCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-cloud-credentials-arn'
  AnalyzeRiSpFunctionArn:
    Description: ARN of analyze-ri-sp Lambda function
    Value: !GetAtt AnalyzeRiSpFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-analyze-ri-sp-arn'
  BudgetForecastFunctionArn:
    Description: ARN of budget-forecast Lambda function
    Value: !GetAtt BudgetForecastFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-budget-forecast-arn'
  CostOptimizationFunctionArn:
    Description: ARN of cost-optimization Lambda function
    Value: !GetAtt CostOptimizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cost-optimization-arn'
  FetchDailyCostsFunctionArn:
    Description: ARN of fetch-daily-costs Lambda function
    Value: !GetAtt FetchDailyCostsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fetch-daily-costs-arn'
  FinopsCopilotFunctionArn:
    Description: ARN of finops-copilot Lambda function
    Value: !GetAtt FinopsCopilotFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-finops-copilot-arn'
  GenerateCostForecastFunctionArn:
    Description: ARN of generate-cost-forecast Lambda function
    Value: !GetAtt GenerateCostForecastFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-cost-forecast-arn'
  GetRiSpAnalysisFunctionArn:
    Description: ARN of get-ri-sp-analysis Lambda function
    Value: !GetAtt GetRiSpAnalysisFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-ri-sp-analysis-arn'
  GetRiSpDataFunctionArn:
    Description: ARN of get-ri-sp-data Lambda function
    Value: !GetAtt GetRiSpDataFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-ri-sp-data-arn'
  ListRiSpHistoryFunctionArn:
    Description: ARN of list-ri-sp-history Lambda function
    Value: !GetAtt ListRiSpHistoryFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-ri-sp-history-arn'
  MlWasteDetectionFunctionArn:
    Description: ARN of ml-waste-detection Lambda function
    Value: !GetAtt MlWasteDetectionFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-ml-waste-detection-arn'
  RiSpAnalyzerFunctionArn:
    Description: ARN of ri-sp-analyzer Lambda function
    Value: !GetAtt RiSpAnalyzerFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-ri-sp-analyzer-arn'
  SaveRiSpAnalysisFunctionArn:
    Description: ARN of save-ri-sp-analysis Lambda function
    Value: !GetAtt SaveRiSpAnalysisFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-save-ri-sp-analysis-arn'
  GetExecutiveDashboardFunctionArn:
    Description: ARN of get-executive-dashboard Lambda function
    Value: !GetAtt GetExecutiveDashboardFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-executive-dashboard-arn'
  GetExecutiveDashboardPublicFunctionArn:
    Description: ARN of get-executive-dashboard-public Lambda function
    Value: !GetAtt GetExecutiveDashboardPublicFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-executive-dashboard-public-arn'
  ManageTvTokensFunctionArn:
    Description: ARN of manage-tv-tokens Lambda function
    Value: !GetAtt ManageTvTokensFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-tv-tokens-arn'
  ManageCloudBudgetFunctionArn:
    Description: ARN of manage-cloud-budget Lambda function
    Value: !GetAtt ManageCloudBudgetFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-cloud-budget-arn'
  CleanupCostDataFunctionArn:
    Description: ARN of cleanup-cost-data Lambda function
    Value: !GetAtt CleanupCostDataFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-cost-data-arn'
  MutateTableFunctionArn:
    Description: ARN of mutate-table Lambda function
    Value: !GetAtt MutateTableFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-mutate-table-arn'
  QueryTableFunctionArn:
    Description: ARN of query-table Lambda function
    Value: !GetAtt QueryTableFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-query-table-arn'
  TicketAttachmentsFunctionArn:
    Description: ARN of ticket-attachments Lambda function
    Value: !GetAtt TicketAttachmentsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-ticket-attachments-arn'
  TicketManagementFunctionArn:
    Description: ARN of ticket-management Lambda function
    Value: !GetAtt TicketManagementFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-ticket-management-arn'
  CheckDailyCostsFunctionArn:
    Description: ARN of check-daily-costs Lambda function
    Value: !GetAtt CheckDailyCostsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-daily-costs-arn'
  DiagnoseCostDashboardFunctionArn:
    Description: ARN of diagnose-cost-dashboard Lambda function
    Value: !GetAtt DiagnoseCostDashboardFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-diagnose-cost-dashboard-arn'
  InvestigateDataMismatchFunctionArn:
    Description: ARN of investigate-data-mismatch Lambda function
    Value: !GetAtt InvestigateDataMismatchFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-investigate-data-mismatch-arn'
  CloudformationWebhookFunctionArn:
    Description: ARN of cloudformation-webhook Lambda function
    Value: !GetAtt CloudformationWebhookFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cloudformation-webhook-arn'
  CreateJiraTicketFunctionArn:
    Description: ARN of create-jira-ticket Lambda function
    Value: !GetAtt CreateJiraTicketFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-jira-ticket-arn'
  AutoCleanupStuckScansFunctionArn:
    Description: ARN of auto-cleanup-stuck-scans Lambda function
    Value: !GetAtt AutoCleanupStuckScansFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-auto-cleanup-stuck-scans-arn'
  CleanupExpiredExternalIdsFunctionArn:
    Description: ARN of cleanup-expired-external-ids Lambda function
    Value: !GetAtt CleanupExpiredExternalIdsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-expired-external-ids-arn'
  CleanupExpiredOauthStatesFunctionArn:
    Description: ARN of cleanup-expired-oauth-states Lambda function
    Value: !GetAtt CleanupExpiredOauthStatesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-expired-oauth-states-arn'
  CleanupStuckScansFunctionArn:
    Description: ARN of cleanup-stuck-scans Lambda function
    Value: !GetAtt CleanupStuckScansFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans-arn'
  ExecuteScheduledJobFunctionArn:
    Description: ARN of execute-scheduled-job Lambda function
    Value: !GetAtt ExecuteScheduledJobFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-execute-scheduled-job-arn'
  InitialDataLoadFunctionArn:
    Description: ARN of initial-data-load Lambda function
    Value: !GetAtt InitialDataLoadFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-initial-data-load-arn'
  ListBackgroundJobsFunctionArn:
    Description: ARN of list-background-jobs Lambda function
    Value: !GetAtt ListBackgroundJobsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-background-jobs-arn'
  ProcessBackgroundJobsFunctionArn:
    Description: ARN of process-background-jobs Lambda function
    Value: !GetAtt ProcessBackgroundJobsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-process-background-jobs-arn'
  ProcessEventsFunctionArn:
    Description: ARN of process-events Lambda function
    Value: !GetAtt ProcessEventsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-process-events-arn'
  ScheduledScanExecutorFunctionArn:
    Description: ARN of scheduled-scan-executor Lambda function
    Value: !GetAtt ScheduledScanExecutorFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-scheduled-scan-executor-arn'
  ScheduledViewRefreshFunctionArn:
    Description: ARN of scheduled-view-refresh Lambda function
    Value: !GetAtt ScheduledViewRefreshFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-scheduled-view-refresh-arn'
  SendScheduledEmailsFunctionArn:
    Description: ARN of send-scheduled-emails Lambda function
    Value: !GetAtt SendScheduledEmailsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-send-scheduled-emails-arn'
  CheckSlaEscalationsFunctionArn:
    Description: ARN of check-sla-escalations Lambda function
    Value: !GetAtt CheckSlaEscalationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-sla-escalations-arn'
  SyncResourceInventoryFunctionArn:
    Description: ARN of sync-resource-inventory Lambda function
    Value: !GetAtt SyncResourceInventoryFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-sync-resource-inventory-arn'
  IncrementArticleHelpfulFunctionArn:
    Description: ARN of increment-article-helpful Lambda function
    Value: !GetAtt IncrementArticleHelpfulFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-increment-article-helpful-arn'
  IncrementArticleViewsFunctionArn:
    Description: ARN of increment-article-views Lambda function
    Value: !GetAtt IncrementArticleViewsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-increment-article-views-arn'
  KbAiSuggestionsFunctionArn:
    Description: ARN of kb-ai-suggestions Lambda function
    Value: !GetAtt KbAiSuggestionsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-kb-ai-suggestions-arn'
  KbAnalyticsDashboardFunctionArn:
    Description: ARN of kb-analytics-dashboard Lambda function
    Value: !GetAtt KbAnalyticsDashboardFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-kb-analytics-dashboard-arn'
  KbArticleTrackingFunctionArn:
    Description: ARN of kb-article-tracking Lambda function
    Value: !GetAtt KbArticleTrackingFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-kb-article-tracking-arn'
  KbExportPdfFunctionArn:
    Description: ARN of kb-export-pdf Lambda function
    Value: !GetAtt KbExportPdfFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-kb-export-pdf-arn'
  TrackArticleViewDetailedFunctionArn:
    Description: ARN of track-article-view-detailed Lambda function
    Value: !GetAtt TrackArticleViewDetailedFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-track-article-view-detailed-arn'
  AdminSyncLicenseFunctionArn:
    Description: ARN of admin-sync-license Lambda function
    Value: !GetAtt AdminSyncLicenseFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-admin-sync-license-arn'
  CleanupSeatsFunctionArn:
    Description: ARN of cleanup-seats Lambda function
    Value: !GetAtt CleanupSeatsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-seats-arn'
  ConfigureLicenseFunctionArn:
    Description: ARN of configure-license Lambda function
    Value: !GetAtt ConfigureLicenseFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-configure-license-arn'
  DailyLicenseValidationFunctionArn:
    Description: ARN of daily-license-validation Lambda function
    Value: !GetAtt DailyLicenseValidationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-daily-license-validation-arn'
  ManageSeatAssignmentsFunctionArn:
    Description: ARN of manage-seat-assignments Lambda function
    Value: !GetAtt ManageSeatAssignmentsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-seat-assignments-arn'
  ManageSeatsFunctionArn:
    Description: ARN of manage-seats Lambda function
    Value: !GetAtt ManageSeatsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-seats-arn'
  ScheduledLicenseSyncFunctionArn:
    Description: ARN of scheduled-license-sync Lambda function
    Value: !GetAtt ScheduledLicenseSyncFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-scheduled-license-sync-arn'
  SyncLicenseFunctionArn:
    Description: ARN of sync-license Lambda function
    Value: !GetAtt SyncLicenseFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-sync-license-arn'
  ValidateLicenseFunctionArn:
    Description: ARN of validate-license Lambda function
    Value: !GetAtt ValidateLicenseFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-license-arn'
  MaintenanceAutoCleanupStuckScansFunctionArn:
    Description: ARN of maintenance-auto-cleanup-stuck-scans Lambda function
    Value: !GetAtt MaintenanceAutoCleanupStuckScansFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-maintenance-auto-cleanup-stuck-scans-arn'
  CleanupStuckScansSimpleFunctionArn:
    Description: ARN of cleanup-stuck-scans-simple Lambda function
    Value: !GetAtt CleanupStuckScansSimpleFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-cleanup-stuck-scans-simple-arn'
  AiPrioritizationFunctionArn:
    Description: ARN of ai-prioritization Lambda function
    Value: !GetAtt AiPrioritizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-ai-prioritization-arn'
  DetectAnomaliesFunctionArn:
    Description: ARN of detect-anomalies Lambda function
    Value: !GetAtt DetectAnomaliesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-detect-anomalies-arn'
  GenerateAiInsightsFunctionArn:
    Description: ARN of generate-ai-insights Lambda function
    Value: !GetAtt GenerateAiInsightsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-ai-insights-arn'
  IntelligentAlertsAnalyzerFunctionArn:
    Description: ARN of intelligent-alerts-analyzer Lambda function
    Value: !GetAtt IntelligentAlertsAnalyzerFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-intelligent-alerts-analyzer-arn'
  PredictIncidentsFunctionArn:
    Description: ARN of predict-incidents Lambda function
    Value: !GetAtt PredictIncidentsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-predict-incidents-arn'
  AlertsFunctionArn:
    Description: ARN of alerts Lambda function
    Value: !GetAtt AlertsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-alerts-arn'
  AutoAlertsFunctionArn:
    Description: ARN of auto-alerts Lambda function
    Value: !GetAtt AutoAlertsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-auto-alerts-arn'
  AwsRealtimeMetricsFunctionArn:
    Description: ARN of aws-realtime-metrics Lambda function
    Value: !GetAtt AwsRealtimeMetricsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-aws-realtime-metrics-arn'
  CheckAlertRulesFunctionArn:
    Description: ARN of check-alert-rules Lambda function
    Value: !GetAtt CheckAlertRulesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-alert-rules-arn'
  EndpointMonitorCheckFunctionArn:
    Description: ARN of endpoint-monitor-check Lambda function
    Value: !GetAtt EndpointMonitorCheckFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-endpoint-monitor-check-arn'
  ErrorAggregatorFunctionArn:
    Description: ARN of error-aggregator Lambda function
    Value: !GetAtt ErrorAggregatorFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-error-aggregator-arn'
  FetchCloudwatchMetricsFunctionArn:
    Description: ARN of fetch-cloudwatch-metrics Lambda function
    Value: !GetAtt FetchCloudwatchMetricsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fetch-cloudwatch-metrics-arn'
  FetchEdgeServicesFunctionArn:
    Description: ARN of fetch-edge-services Lambda function
    Value: !GetAtt FetchEdgeServicesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fetch-edge-services-arn'
  GenerateErrorFixPromptFunctionArn:
    Description: ARN of generate-error-fix-prompt Lambda function
    Value: !GetAtt GenerateErrorFixPromptFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-error-fix-prompt-arn'
  GetLambdaHealthFunctionArn:
    Description: ARN of get-lambda-health Lambda function
    Value: !GetAtt GetLambdaHealthFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-lambda-health-arn'
  GetPlatformMetricsFunctionArn:
    Description: ARN of get-platform-metrics Lambda function
    Value: !GetAtt GetPlatformMetricsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-platform-metrics-arn'
  GetRecentErrorsFunctionArn:
    Description: ARN of get-recent-errors Lambda function
    Value: !GetAtt GetRecentErrorsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-recent-errors-arn'
  HealthCheckFunctionArn:
    Description: ARN of health-check Lambda function
    Value: !GetAtt HealthCheckFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-health-check-arn'
  LambdaHealthCheckFunctionArn:
    Description: ARN of lambda-health-check Lambda function
    Value: !GetAtt LambdaHealthCheckFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-lambda-health-check-arn'
  LogFrontendErrorFunctionArn:
    Description: ARN of log-frontend-error Lambda function
    Value: !GetAtt LogFrontendErrorFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-log-frontend-error-arn'
  MonitoredEndpointsFunctionArn:
    Description: ARN of monitored-endpoints Lambda function
    Value: !GetAtt MonitoredEndpointsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-monitored-endpoints-arn'
  TestLambdaMetricsFunctionArn:
    Description: ARN of test-lambda-metrics Lambda function
    Value: !GetAtt TestLambdaMetricsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-test-lambda-metrics-arn'
  GetCommunicationLogsFunctionArn:
    Description: ARN of get-communication-logs Lambda function
    Value: !GetAtt GetCommunicationLogsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-communication-logs-arn'
  ManageEmailPreferencesFunctionArn:
    Description: ARN of manage-email-preferences Lambda function
    Value: !GetAtt ManageEmailPreferencesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-manage-email-preferences-arn'
  SendEmailFunctionArn:
    Description: ARN of send-email Lambda function
    Value: !GetAtt SendEmailFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-send-email-arn'
  SendNotificationFunctionArn:
    Description: ARN of send-notification Lambda function
    Value: !GetAtt SendNotificationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-send-notification-arn'
  CreateOrganizationAccountFunctionArn:
    Description: ARN of create-organization-account Lambda function
    Value: !GetAtt CreateOrganizationAccountFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-organization-account-arn'
  SyncOrganizationAccountsFunctionArn:
    Description: ARN of sync-organization-accounts Lambda function
    Value: !GetAtt SyncOrganizationAccountsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-sync-organization-accounts-arn'
  CheckOrganizationFunctionArn:
    Description: ARN of check-organization Lambda function
    Value: !GetAtt CheckOrganizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-organization-arn'
  CreateWithOrganizationFunctionArn:
    Description: ARN of create-with-organization Lambda function
    Value: !GetAtt CreateWithOrganizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-with-organization-arn'
  GetUserOrganizationFunctionArn:
    Description: ARN of get-user-organization Lambda function
    Value: !GetAtt GetUserOrganizationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-user-organization-arn'
  GenerateExcelReportFunctionArn:
    Description: ARN of generate-excel-report Lambda function
    Value: !GetAtt GenerateExcelReportFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-excel-report-arn'
  GeneratePdfReportFunctionArn:
    Description: ARN of generate-pdf-report Lambda function
    Value: !GetAtt GeneratePdfReportFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-pdf-report-arn'
  GenerateRemediationScriptFunctionArn:
    Description: ARN of generate-remediation-script Lambda function
    Value: !GetAtt GenerateRemediationScriptFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-remediation-script-arn'
  GenerateSecurityPdfFunctionArn:
    Description: ARN of generate-security-pdf Lambda function
    Value: !GetAtt GenerateSecurityPdfFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-generate-security-pdf-arn'
  SecurityScanPdfExportFunctionArn:
    Description: ARN of security-scan-pdf-export Lambda function
    Value: !GetAtt SecurityScanPdfExportFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-security-scan-pdf-export-arn'
  AnalyzeCloudtrailFunctionArn:
    Description: ARN of analyze-cloudtrail Lambda function
    Value: !GetAtt AnalyzeCloudtrailFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-analyze-cloudtrail-arn'
  ComplianceScanFunctionArn:
    Description: ARN of compliance-scan Lambda function
    Value: !GetAtt ComplianceScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-compliance-scan-arn'
  CreateRemediationTicketFunctionArn:
    Description: ARN of create-remediation-ticket Lambda function
    Value: !GetAtt CreateRemediationTicketFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-create-remediation-ticket-arn'
  DriftDetectionFunctionArn:
    Description: ARN of drift-detection Lambda function
    Value: !GetAtt DriftDetectionFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-drift-detection-arn'
  FetchCloudtrailFunctionArn:
    Description: ARN of fetch-cloudtrail Lambda function
    Value: !GetAtt FetchCloudtrailFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fetch-cloudtrail-arn'
  GetComplianceHistoryFunctionArn:
    Description: ARN of get-compliance-history Lambda function
    Value: !GetAtt GetComplianceHistoryFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-compliance-history-arn'
  GetComplianceScanStatusFunctionArn:
    Description: ARN of get-compliance-scan-status Lambda function
    Value: !GetAtt GetComplianceScanStatusFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-compliance-scan-status-arn'
  GetFindingsFunctionArn:
    Description: ARN of get-findings Lambda function
    Value: !GetAtt GetFindingsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-findings-arn'
  GetSecurityPostureFunctionArn:
    Description: ARN of get-security-posture Lambda function
    Value: !GetAtt GetSecurityPostureFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-get-security-posture-arn'
  GuarddutyScanFunctionArn:
    Description: ARN of guardduty-scan Lambda function
    Value: !GetAtt GuarddutyScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-guardduty-scan-arn'
  IamBehaviorAnalysisFunctionArn:
    Description: ARN of iam-behavior-analysis Lambda function
    Value: !GetAtt IamBehaviorAnalysisFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-iam-behavior-analysis-arn'
  IamDeepAnalysisFunctionArn:
    Description: ARN of iam-deep-analysis Lambda function
    Value: !GetAtt IamDeepAnalysisFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-iam-deep-analysis-arn'
  LateralMovementDetectionFunctionArn:
    Description: ARN of lateral-movement-detection Lambda function
    Value: !GetAtt LateralMovementDetectionFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-lateral-movement-detection-arn'
  SecurityScanFunctionArn:
    Description: ARN of security-scan Lambda function
    Value: !GetAtt SecurityScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-security-scan-arn'
  StartAnalyzeCloudtrailFunctionArn:
    Description: ARN of start-analyze-cloudtrail Lambda function
    Value: !GetAtt StartAnalyzeCloudtrailFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-start-analyze-cloudtrail-arn'
  StartCloudtrailAnalysisFunctionArn:
    Description: ARN of start-cloudtrail-analysis Lambda function
    Value: !GetAtt StartCloudtrailAnalysisFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-start-cloudtrail-analysis-arn'
  StartComplianceScanFunctionArn:
    Description: ARN of start-compliance-scan Lambda function
    Value: !GetAtt StartComplianceScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-start-compliance-scan-arn'
  StartSecurityScanFunctionArn:
    Description: ARN of start-security-scan Lambda function
    Value: !GetAtt StartSecurityScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-start-security-scan-arn'
  ValidateAwsCredentialsFunctionArn:
    Description: ARN of validate-aws-credentials Lambda function
    Value: !GetAtt ValidateAwsCredentialsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-aws-credentials-arn'
  ValidatePermissionsFunctionArn:
    Description: ARN of validate-permissions Lambda function
    Value: !GetAtt ValidatePermissionsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-permissions-arn'
  ValidateWafSecurityFunctionArn:
    Description: ARN of validate-waf-security Lambda function
    Value: !GetAtt ValidateWafSecurityFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-validate-waf-security-arn'
  WafDashboardApiFunctionArn:
    Description: ARN of waf-dashboard-api Lambda function
    Value: !GetAtt WafDashboardApiFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-dashboard-api-arn'
  WafLogForwarderFunctionArn:
    Description: ARN of waf-log-forwarder Lambda function
    Value: !GetAtt WafLogForwarderFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-log-forwarder-arn'
  WafLogProcessorFunctionArn:
    Description: ARN of waf-log-processor Lambda function
    Value: !GetAtt WafLogProcessorFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-log-processor-arn'
  WafSetupMonitoringFunctionArn:
    Description: ARN of waf-setup-monitoring Lambda function
    Value: !GetAtt WafSetupMonitoringFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-setup-monitoring-arn'
  WafThreatAnalyzerFunctionArn:
    Description: ARN of waf-threat-analyzer Lambda function
    Value: !GetAtt WafThreatAnalyzerFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-threat-analyzer-arn'
  WafUnblockExpiredFunctionArn:
    Description: ARN of waf-unblock-expired Lambda function
    Value: !GetAtt WafUnblockExpiredFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-waf-unblock-expired-arn'
  WellArchitectedScanFunctionArn:
    Description: ARN of well-architected-scan Lambda function
    Value: !GetAtt WellArchitectedScanFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-well-architected-scan-arn'
  StorageDownloadFunctionArn:
    Description: ARN of storage-download Lambda function
    Value: !GetAtt StorageDownloadFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-storage-download-arn'
  StorageDeleteFunctionArn:
    Description: ARN of storage-delete Lambda function
    Value: !GetAtt StorageDeleteFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-storage-delete-arn'
  UploadAttachmentFunctionArn:
    Description: ARN of upload-attachment Lambda function
    Value: !GetAtt UploadAttachmentFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-upload-attachment-arn'
  AddStatusColumnFunctionArn:
    Description: ARN of add-status-column Lambda function
    Value: !GetAtt AddStatusColumnFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-add-status-column-arn'
  CheckMigrationsFunctionArn:
    Description: ARN of check-migrations Lambda function
    Value: !GetAtt CheckMigrationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-check-migrations-arn'
  DbInitFunctionArn:
    Description: ARN of db-init Lambda function
    Value: !GetAtt DbInitFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-db-init-arn'
  DebugOrgQueryFunctionArn:
    Description: ARN of debug-org-query Lambda function
    Value: !GetAtt DebugOrgQueryFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-debug-org-query-arn'
  FixAzureConstraintsFunctionArn:
    Description: ARN of fix-azure-constraints Lambda function
    Value: !GetAtt FixAzureConstraintsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-fix-azure-constraints-arn'
  ListTablesFunctionArn:
    Description: ARN of list-tables Lambda function
    Value: !GetAtt ListTablesFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-list-tables-arn'
  RunMigrationsFunctionArn:
    Description: ARN of run-migrations Lambda function
    Value: !GetAtt RunMigrationsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-run-migrations-arn'
  RunSqlMigrationFunctionArn:
    Description: ARN of run-sql-migration Lambda function
    Value: !GetAtt RunSqlMigrationFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-run-sql-migration-arn'
  NotificationSettingsFunctionArn:
    Description: ARN of notification-settings Lambda function
    Value: !GetAtt NotificationSettingsFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-notification-settings-arn'
  WebsocketConnectFunctionArn:
    Description: ARN of websocket-connect Lambda function
    Value: !GetAtt WebsocketConnectFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-websocket-connect-arn'
  WebsocketDisconnectFunctionArn:
    Description: ARN of websocket-disconnect Lambda function
    Value: !GetAtt WebsocketDisconnectFunction.Arn
    Export:
      Name: !Sub '${ProjectName}-${Environment}-websocket-disconnect-arn'

  AdminManageUserEndpointUrl:
    Description: API endpoint URL for admin-manage-user
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/admin-manage-user'
  CreateCognitoUserEndpointUrl:
    Description: API endpoint URL for create-cognito-user
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/create-cognito-user'
  CreateUserEndpointUrl:
    Description: API endpoint URL for create-user
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/create-user'
  DeactivateDemoModeEndpointUrl:
    Description: API endpoint URL for deactivate-demo-mode
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/deactivate-demo-mode'
  DisableCognitoUserEndpointUrl:
    Description: API endpoint URL for disable-cognito-user
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/disable-cognito-user'
  LogAuditEndpointUrl:
    Description: API endpoint URL for log-audit
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/log-audit'
  ManageDemoModeEndpointUrl:
    Description: API endpoint URL for manage-demo-mode
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-demo-mode'
  ManageEmailTemplatesEndpointUrl:
    Description: API endpoint URL for manage-email-templates
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-email-templates'
  ManageOrganizationsEndpointUrl:
    Description: API endpoint URL for manage-organizations
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-organizations'
  BedrockChatEndpointUrl:
    Description: API endpoint URL for bedrock-chat
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/bedrock-chat'
  GetAiNotificationsEndpointUrl:
    Description: API endpoint URL for get-ai-notifications
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-ai-notifications'
  ListAiNotificationsAdminEndpointUrl:
    Description: API endpoint URL for list-ai-notifications-admin
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-ai-notifications-admin'
  ManageNotificationRulesEndpointUrl:
    Description: API endpoint URL for manage-notification-rules
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-notification-rules'
  SendAiNotificationEndpointUrl:
    Description: API endpoint URL for send-ai-notification
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/send-ai-notification'
  UpdateAiNotificationEndpointUrl:
    Description: API endpoint URL for update-ai-notification
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/update-ai-notification'
  DeleteWebauthnCredentialEndpointUrl:
    Description: API endpoint URL for delete-webauthn-credential
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/delete-webauthn-credential'
  ForgotPasswordEndpointUrl:
    Description: API endpoint URL for forgot-password
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/forgot-password'
  MfaEnrollEndpointUrl:
    Description: API endpoint URL for mfa-enroll
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-enroll'
  MfaCheckEndpointUrl:
    Description: API endpoint URL for mfa-check
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-check'
  MfaChallengeVerifyEndpointUrl:
    Description: API endpoint URL for mfa-challenge-verify
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-challenge-verify'
  MfaVerifyLoginEndpointUrl:
    Description: API endpoint URL for mfa-verify-login
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-verify-login'
  MfaListFactorsEndpointUrl:
    Description: API endpoint URL for mfa-list-factors
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-list-factors'
  MfaUnenrollEndpointUrl:
    Description: API endpoint URL for mfa-unenroll
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mfa-unenroll'
  SelfRegisterEndpointUrl:
    Description: API endpoint URL for self-register
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/self-register'
  VerifyTvTokenEndpointUrl:
    Description: API endpoint URL for verify-tv-token
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/verify-tv-token'
  WebauthnAuthenticateEndpointUrl:
    Description: API endpoint URL for webauthn-authenticate
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/webauthn-authenticate'
  WebauthnCheckEndpointUrl:
    Description: API endpoint URL for webauthn-check
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/webauthn-check'
  WebauthnRegisterEndpointUrl:
    Description: API endpoint URL for webauthn-register
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/webauthn-register'
  ListAwsCredentialsEndpointUrl:
    Description: API endpoint URL for list-aws-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-aws-credentials'
  SaveAwsCredentialsEndpointUrl:
    Description: API endpoint URL for save-aws-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/save-aws-credentials'
  UpdateAwsCredentialsEndpointUrl:
    Description: API endpoint URL for update-aws-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/update-aws-credentials'
  AzureActivityLogsEndpointUrl:
    Description: API endpoint URL for azure-activity-logs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-activity-logs'
  AzureComplianceScanEndpointUrl:
    Description: API endpoint URL for azure-compliance-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-compliance-scan'
  AzureCostOptimizationEndpointUrl:
    Description: API endpoint URL for azure-cost-optimization
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-cost-optimization'
  AzureDefenderScanEndpointUrl:
    Description: API endpoint URL for azure-defender-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-defender-scan'
  AzureDetectAnomaliesEndpointUrl:
    Description: API endpoint URL for azure-detect-anomalies
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-detect-anomalies'
  AzureFetchCostsEndpointUrl:
    Description: API endpoint URL for azure-fetch-costs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-fetch-costs'
  AzureFetchEdgeServicesEndpointUrl:
    Description: API endpoint URL for azure-fetch-edge-services
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-fetch-edge-services'
  AzureFetchMonitorMetricsEndpointUrl:
    Description: API endpoint URL for azure-fetch-monitor-metrics
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-fetch-monitor-metrics'
  AzureOauthCallbackEndpointUrl:
    Description: API endpoint URL for azure-oauth-callback
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-oauth-callback'
  AzureOauthInitiateEndpointUrl:
    Description: API endpoint URL for azure-oauth-initiate
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-oauth-initiate'
  AzureOauthRefreshEndpointUrl:
    Description: API endpoint URL for azure-oauth-refresh
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-oauth-refresh'
  AzureOauthRevokeEndpointUrl:
    Description: API endpoint URL for azure-oauth-revoke
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-oauth-revoke'
  AzureReservationsAnalyzerEndpointUrl:
    Description: API endpoint URL for azure-reservations-analyzer
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-reservations-analyzer'
  AzureResourceInventoryEndpointUrl:
    Description: API endpoint URL for azure-resource-inventory
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-resource-inventory'
  AzureSecurityScanEndpointUrl:
    Description: API endpoint URL for azure-security-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-security-scan'
  AzureWellArchitectedScanEndpointUrl:
    Description: API endpoint URL for azure-well-architected-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/azure-well-architected-scan'
  DeleteAzureCredentialsEndpointUrl:
    Description: API endpoint URL for delete-azure-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/delete-azure-credentials'
  ListAzureCredentialsEndpointUrl:
    Description: API endpoint URL for list-azure-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-azure-credentials'
  SaveAzureCredentialsEndpointUrl:
    Description: API endpoint URL for save-azure-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/save-azure-credentials'
  StartAzureSecurityScanEndpointUrl:
    Description: API endpoint URL for start-azure-security-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/start-azure-security-scan'
  ValidateAzureCredentialsEndpointUrl:
    Description: API endpoint URL for validate-azure-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/validate-azure-credentials'
  ValidateAzurePermissionsEndpointUrl:
    Description: API endpoint URL for validate-azure-permissions
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/validate-azure-permissions'
  ListCloudCredentialsEndpointUrl:
    Description: API endpoint URL for list-cloud-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-cloud-credentials'
  AnalyzeRiSpEndpointUrl:
    Description: API endpoint URL for analyze-ri-sp
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/analyze-ri-sp'
  BudgetForecastEndpointUrl:
    Description: API endpoint URL for budget-forecast
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/budget-forecast'
  CostOptimizationEndpointUrl:
    Description: API endpoint URL for cost-optimization
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/cost-optimization'
  FetchDailyCostsEndpointUrl:
    Description: API endpoint URL for fetch-daily-costs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/fetch-daily-costs'
  FinopsCopilotEndpointUrl:
    Description: API endpoint URL for finops-copilot
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/finops-copilot'
  GenerateCostForecastEndpointUrl:
    Description: API endpoint URL for generate-cost-forecast
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-cost-forecast'
  GetRiSpAnalysisEndpointUrl:
    Description: API endpoint URL for get-ri-sp-analysis
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-ri-sp-analysis'
  GetRiSpDataEndpointUrl:
    Description: API endpoint URL for get-ri-sp-data
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-ri-sp-data'
  ListRiSpHistoryEndpointUrl:
    Description: API endpoint URL for list-ri-sp-history
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-ri-sp-history'
  MlWasteDetectionEndpointUrl:
    Description: API endpoint URL for ml-waste-detection
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/ml-waste-detection'
  RiSpAnalyzerEndpointUrl:
    Description: API endpoint URL for ri-sp-analyzer
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/ri-sp-analyzer'
  GetExecutiveDashboardEndpointUrl:
    Description: API endpoint URL for get-executive-dashboard
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-executive-dashboard'
  GetExecutiveDashboardPublicEndpointUrl:
    Description: API endpoint URL for get-executive-dashboard-public
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-executive-dashboard-public'
  ManageTvTokensEndpointUrl:
    Description: API endpoint URL for manage-tv-tokens
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-tv-tokens'
  ManageCloudBudgetEndpointUrl:
    Description: API endpoint URL for manage-cloud-budget
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-cloud-budget'
  MutateTableEndpointUrl:
    Description: API endpoint URL for mutate-table
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/mutate-table'
  QueryTableEndpointUrl:
    Description: API endpoint URL for query-table
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/query-table'
  TicketAttachmentsEndpointUrl:
    Description: API endpoint URL for ticket-attachments
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/ticket-attachments'
  TicketManagementEndpointUrl:
    Description: API endpoint URL for ticket-management
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/ticket-management'
  CloudformationWebhookEndpointUrl:
    Description: API endpoint URL for cloudformation-webhook
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/cloudformation-webhook'
  CreateJiraTicketEndpointUrl:
    Description: API endpoint URL for create-jira-ticket
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/create-jira-ticket'
  ExecuteScheduledJobEndpointUrl:
    Description: API endpoint URL for execute-scheduled-job
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/execute-scheduled-job'
  ListBackgroundJobsEndpointUrl:
    Description: API endpoint URL for list-background-jobs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/list-background-jobs'
  ProcessBackgroundJobsEndpointUrl:
    Description: API endpoint URL for process-background-jobs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/process-background-jobs'
  ScheduledScanExecutorEndpointUrl:
    Description: API endpoint URL for scheduled-scan-executor
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/scheduled-scan-executor'
  IncrementArticleHelpfulEndpointUrl:
    Description: API endpoint URL for increment-article-helpful
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/increment-article-helpful'
  IncrementArticleViewsEndpointUrl:
    Description: API endpoint URL for increment-article-views
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/increment-article-views'
  KbAiSuggestionsEndpointUrl:
    Description: API endpoint URL for kb-ai-suggestions
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/kb-ai-suggestions'
  KbAnalyticsDashboardEndpointUrl:
    Description: API endpoint URL for kb-analytics-dashboard
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/kb-analytics-dashboard'
  KbExportPdfEndpointUrl:
    Description: API endpoint URL for kb-export-pdf
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/kb-export-pdf'
  TrackArticleViewDetailedEndpointUrl:
    Description: API endpoint URL for track-article-view-detailed
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/track-article-view-detailed'
  AdminSyncLicenseEndpointUrl:
    Description: API endpoint URL for admin-sync-license
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/admin-sync-license'
  ConfigureLicenseEndpointUrl:
    Description: API endpoint URL for configure-license
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/configure-license'
  ManageSeatsEndpointUrl:
    Description: API endpoint URL for manage-seats
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-seats'
  SyncLicenseEndpointUrl:
    Description: API endpoint URL for sync-license
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/sync-license'
  ValidateLicenseEndpointUrl:
    Description: API endpoint URL for validate-license
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/validate-license'
  DetectAnomaliesEndpointUrl:
    Description: API endpoint URL for detect-anomalies
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/detect-anomalies'
  IntelligentAlertsAnalyzerEndpointUrl:
    Description: API endpoint URL for intelligent-alerts-analyzer
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/intelligent-alerts-analyzer'
  PredictIncidentsEndpointUrl:
    Description: API endpoint URL for predict-incidents
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/predict-incidents'
  AlertsEndpointUrl:
    Description: API endpoint URL for alerts
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/alerts'
  AutoAlertsEndpointUrl:
    Description: API endpoint URL for auto-alerts
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/auto-alerts'
  AwsRealtimeMetricsEndpointUrl:
    Description: API endpoint URL for aws-realtime-metrics
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/aws-realtime-metrics'
  CheckAlertRulesEndpointUrl:
    Description: API endpoint URL for check-alert-rules
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/check-alert-rules'
  EndpointMonitorCheckEndpointUrl:
    Description: API endpoint URL for endpoint-monitor-check
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/endpoint-monitor-check'
  FetchCloudwatchMetricsEndpointUrl:
    Description: API endpoint URL for fetch-cloudwatch-metrics
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/fetch-cloudwatch-metrics'
  FetchEdgeServicesEndpointUrl:
    Description: API endpoint URL for fetch-edge-services
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/fetch-edge-services'
  GenerateErrorFixPromptEndpointUrl:
    Description: API endpoint URL for generate-error-fix-prompt
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-error-fix-prompt'
  GetLambdaHealthEndpointUrl:
    Description: API endpoint URL for get-lambda-health
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-lambda-health'
  GetPlatformMetricsEndpointUrl:
    Description: API endpoint URL for get-platform-metrics
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-platform-metrics'
  GetRecentErrorsEndpointUrl:
    Description: API endpoint URL for get-recent-errors
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-recent-errors'
  LogFrontendErrorEndpointUrl:
    Description: API endpoint URL for log-frontend-error
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/log-frontend-error'
  MonitoredEndpointsEndpointUrl:
    Description: API endpoint URL for monitored-endpoints
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/monitored-endpoints'
  GetCommunicationLogsEndpointUrl:
    Description: API endpoint URL for get-communication-logs
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-communication-logs'
  ManageEmailPreferencesEndpointUrl:
    Description: API endpoint URL for manage-email-preferences
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/manage-email-preferences'
  SendEmailEndpointUrl:
    Description: API endpoint URL for send-email
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/send-email'
  SendNotificationEndpointUrl:
    Description: API endpoint URL for send-notification
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/send-notification'
  CreateOrganizationAccountEndpointUrl:
    Description: API endpoint URL for create-organization-account
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/create-organization-account'
  SyncOrganizationAccountsEndpointUrl:
    Description: API endpoint URL for sync-organization-accounts
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/sync-organization-accounts'
  CheckOrganizationEndpointUrl:
    Description: API endpoint URL for check-organization
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/check-organization'
  CreateWithOrganizationEndpointUrl:
    Description: API endpoint URL for create-with-organization
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/create-with-organization'
  GetUserOrganizationEndpointUrl:
    Description: API endpoint URL for get-user-organization
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-user-organization'
  GenerateExcelReportEndpointUrl:
    Description: API endpoint URL for generate-excel-report
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-excel-report'
  GeneratePdfReportEndpointUrl:
    Description: API endpoint URL for generate-pdf-report
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-pdf-report'
  GenerateRemediationScriptEndpointUrl:
    Description: API endpoint URL for generate-remediation-script
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-remediation-script'
  GenerateSecurityPdfEndpointUrl:
    Description: API endpoint URL for generate-security-pdf
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/generate-security-pdf'
  SecurityScanPdfExportEndpointUrl:
    Description: API endpoint URL for security-scan-pdf-export
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/security-scan-pdf-export'
  AnalyzeCloudtrailEndpointUrl:
    Description: API endpoint URL for analyze-cloudtrail
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/analyze-cloudtrail'
  ComplianceScanEndpointUrl:
    Description: API endpoint URL for compliance-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/compliance-scan'
  DriftDetectionEndpointUrl:
    Description: API endpoint URL for drift-detection
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/drift-detection'
  FetchCloudtrailEndpointUrl:
    Description: API endpoint URL for fetch-cloudtrail
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/fetch-cloudtrail'
  GetComplianceHistoryEndpointUrl:
    Description: API endpoint URL for get-compliance-history
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-compliance-history'
  GetComplianceScanStatusEndpointUrl:
    Description: API endpoint URL for get-compliance-scan-status
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-compliance-scan-status'
  GetFindingsEndpointUrl:
    Description: API endpoint URL for get-findings
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-findings'
  GetSecurityPostureEndpointUrl:
    Description: API endpoint URL for get-security-posture
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/get-security-posture'
  GuarddutyScanEndpointUrl:
    Description: API endpoint URL for guardduty-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/guardduty-scan'
  IamDeepAnalysisEndpointUrl:
    Description: API endpoint URL for iam-deep-analysis
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/iam-deep-analysis'
  LateralMovementDetectionEndpointUrl:
    Description: API endpoint URL for lateral-movement-detection
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/lateral-movement-detection'
  SecurityScanEndpointUrl:
    Description: API endpoint URL for security-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/security-scan'
  StartCloudtrailAnalysisEndpointUrl:
    Description: API endpoint URL for start-cloudtrail-analysis
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/start-cloudtrail-analysis'
  StartComplianceScanEndpointUrl:
    Description: API endpoint URL for start-compliance-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/start-compliance-scan'
  StartSecurityScanEndpointUrl:
    Description: API endpoint URL for start-security-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/start-security-scan'
  ValidateAwsCredentialsEndpointUrl:
    Description: API endpoint URL for validate-aws-credentials
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/validate-aws-credentials'
  ValidatePermissionsEndpointUrl:
    Description: API endpoint URL for validate-permissions
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/validate-permissions'
  WafDashboardApiEndpointUrl:
    Description: API endpoint URL for waf-dashboard-api
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/waf-dashboard-api'
  WafSetupMonitoringEndpointUrl:
    Description: API endpoint URL for waf-setup-monitoring
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/waf-setup-monitoring'
  WellArchitectedScanEndpointUrl:
    Description: API endpoint URL for well-architected-scan
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/well-architected-scan'
  StorageDownloadEndpointUrl:
    Description: API endpoint URL for storage-download
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/storage-download'
  StorageDeleteEndpointUrl:
    Description: API endpoint URL for storage-delete
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/storage-delete'
  UploadAttachmentEndpointUrl:
    Description: API endpoint URL for upload-attachment
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/upload-attachment'
  DbInitEndpointUrl:
    Description: API endpoint URL for db-init
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/db-init'
  NotificationSettingsEndpointUrl:
    Description: API endpoint URL for notification-settings
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/notification-settings'
  WebsocketConnectEndpointUrl:
    Description: API endpoint URL for websocket-connect
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/websocket-connect'
  WebsocketDisconnectEndpointUrl:
    Description: API endpoint URL for websocket-disconnect
    Value: !Sub 'https://${RestApiId}.execute-api.${AWS::Region}.amazonaws.com/prod/api/functions/websocket-disconnect'