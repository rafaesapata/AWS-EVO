import { createRoot } from "react-dom/client";
import { BrowserRouter, Routes, Route, Navigate } from "react-router-dom";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { Toaster } from "@/components/ui/toaster";
import { lazy, Suspense } from "react";
import Index from "./pages/Index";
import Auth from "./pages/Auth";
import ChangePassword from "./pages/ChangePassword";
import TVDashboard from "./pages/TVDashboard";
import NotFound from "./pages/NotFound";
import Features from "./pages/Features";
import TermsOfService from "./pages/TermsOfService";
import AuthGuard from "./components/AuthGuard";
import LoadingSkeleton from "./components/LoadingSkeleton";
import { AwsAccountProvider } from "./contexts/AwsAccountContext";
import "./i18n/config";
import "./index.css";

// Lazy load heavy pages
const ThreatDetection = lazy(() => import("./pages/ThreatDetection"));
const MLWasteDetection = lazy(() => import("./pages/MLWasteDetection"));
const AttackDetection = lazy(() => import("./pages/AttackDetection"));
const ResourceMonitoring = lazy(() => import("./pages/ResourceMonitoring"));
const WellArchitected = lazy(() => import("./pages/WellArchitected"));
const AWSSettings = lazy(() => import("./pages/AWSSettings"));
const KnowledgeBase = lazy(() => import("./pages/KnowledgeBase"));
const LicenseManagement = lazy(() => import("./pages/LicenseManagement"));
const AnomalyDetection = lazy(() => import("./pages/AnomalyDetection"));
const PredictiveIncidents = lazy(() => import("./pages/PredictiveIncidents"));
const CommunicationCenter = lazy(() => import("./pages/CommunicationCenter"));
const BedrockTestPage = lazy(() => import("./pages/BedrockTestPage"));

const queryClient = new QueryClient();

createRoot(document.getElementById("root")!).render(
  <QueryClientProvider client={queryClient}>
    <BrowserRouter future={{ v7_startTransition: true, v7_relativeSplatPath: true }}>
      <Routes>
        <Route path="/" element={<Auth />} />
        <Route path="/auth" element={<Auth />} />
        <Route path="/features" element={<Features />} />
        <Route path="/terms" element={<TermsOfService />} />
        <Route path="/tv/:token" element={<TVDashboard />} />
        <Route
          path="/change-password"
          element={
            <AuthGuard>
              <ChangePassword />
            </AuthGuard>
          }
        />
        <Route
          path="/app"
          element={
            <AuthGuard>
              <Index />
            </AuthGuard>
          }
        />
        <Route
          path="/threat-detection"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <ThreatDetection />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/ml-waste-detection"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <MLWasteDetection />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/attack-detection"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <AttackDetection />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/resource-monitoring"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <ResourceMonitoring />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/well-architected"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <WellArchitected />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/knowledge-base"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <KnowledgeBase />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/aws-settings"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <AWSSettings />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/license"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <LicenseManagement />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/anomaly-detection"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <AnomalyDetection />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/predictive-incidents"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <PredictiveIncidents />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/communication-center"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <CommunicationCenter />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route
          path="/bedrock-test"
          element={
            <AuthGuard>
              <Suspense fallback={<LoadingSkeleton />}>
                <BedrockTestPage />
              </Suspense>
            </AuthGuard>
          }
        />
        <Route path="/404" element={<NotFound />} />
        <Route path="*" element={<Navigate to="/404" replace />} />
      </Routes>
      <Toaster />
    </BrowserRouter>
  </QueryClientProvider>
);
